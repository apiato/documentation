"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5328],{95788:(e,n,t)=>{t.d(n,{Iu:()=>u,yg:()=>h});var a=t(11504);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(t),m=i,h=d["".concat(l,".").concat(m)]||d[m]||c[m]||r;return t?a.createElement(h,o(o({ref:n},u),{},{components:t})):a.createElement(h,o({ref:n},u))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5196:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=t(45072),i=(t(11504),t(95788));const r={sidebar_position:3,title:"Requests",tags:["component","main-component","request","route","controller","action"]},o=void 0,s={unversionedId:"components/main-components/requests",id:"components/main-components/requests",title:"Requests",description:"Requests components are a way to interact with the current HTTP request",source:"@site/docs/components/main-components/requests.md",sourceDirName:"components/main-components",slug:"/components/main-components/requests",permalink:"/docs/next/components/main-components/requests",draft:!1,editUrl:"https://github.com/apiato/documentation/tree/master/docs/components/main-components/requests.md",tags:[{label:"component",permalink:"/docs/next/tags/component"},{label:"main-component",permalink:"/docs/next/tags/main-component"},{label:"request",permalink:"/docs/next/tags/request"},{label:"route",permalink:"/docs/next/tags/route"},{label:"controller",permalink:"/docs/next/tags/controller"},{label:"action",permalink:"/docs/next/tags/action"}],version:"current",lastUpdatedBy:"Mohammad Alavi",lastUpdatedAt:1704287783,formattedLastUpdatedAt:"Jan 3, 2024",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Requests",tags:["component","main-component","request","route","controller","action"]},sidebar:"tutorialSidebar",previous:{title:"Controllers",permalink:"/docs/next/components/main-components/controllers"},next:{title:"Actions",permalink:"/docs/next/components/main-components/actions"}},l={},p=[{value:"Definition &amp; Principles",id:"definition--principles",level:2},{value:"Rules",id:"rules",level:2},{value:"Folder Structure",id:"folder-structure",level:2},{value:"Code Example",id:"code-example",level:2},{value:"Validation",id:"validation",level:2},{value:"Request Properties",id:"request-properties",level:2},{value:"access",id:"access",level:3},{value:"decode",id:"decode",level:3},{value:"urlParameters",id:"urlparameters",level:3},{value:"Helper Methods",id:"helper-methods",level:2},{value:"check",id:"check",level:3},{value:"hasAccess",id:"hasaccess",level:3},{value:"sanitizeInput",id:"sanitizeinput",level:3},{value:"getInputByKey",id:"getinputbykey",level:3},{value:"mapInput",id:"mapinput",level:3},{value:"injectData",id:"injectdata",level:3},{value:"withUrlParameters",id:"withurlparameters",level:3},{value:"Custom Authorize Methods",id:"custom-authorize-methods",level:2},{value:"Bypass Authorization",id:"bypass-authorization",level:2},{value:"Force Accept Header",id:"force-accept-header",level:2},{value:"Etag",id:"etag",level:2}],u={toc:p},d="wrapper";function c(e){let{components:n,...t}=e;return(0,i.yg)(d,(0,a.c)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"https://laravel.com/docs/requests"},"Requests")," components are a way to interact with the current HTTP request\nbeing handled by your application as well as retrieve the input,\ncookies, and files that were submitted with the request."),(0,i.yg)("p",null,"To generate new requests you may use the ",(0,i.yg)("inlineCode",{parentName:"p"},"apiato:generate:request")," interactive command:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"php artisan apiato:generate:request\n")),(0,i.yg)("h2",{id:"definition--principles"},"Definition & Principles"),(0,i.yg)("p",null,"Read ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/Mahmoudz/Porto#definitions--principles"},(0,i.yg)("strong",{parentName:"a"},"Porto SAP Documentation (#Requests)")),"."),(0,i.yg)("h2",{id:"rules"},"Rules"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Validation rules MUST be defined in the ",(0,i.yg)("inlineCode",{parentName:"li"},"rules")," method."),(0,i.yg)("li",{parentName:"ul"},"All API Requests MUST be placed in the ",(0,i.yg)("inlineCode",{parentName:"li"},"app/Containers/{Section}/{Container}/UI/API/Requests")," directory."),(0,i.yg)("li",{parentName:"ul"},"All Web Requests MUST be placed in the ",(0,i.yg)("inlineCode",{parentName:"li"},"app/Containers/{Section}/{Container}/UI/WEB/Requests")," directory."),(0,i.yg)("li",{parentName:"ul"},"All Requests:",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"MUST extend the ",(0,i.yg)("inlineCode",{parentName:"li"},"App\\Ship\\Parents\\Requests\\Request")," class.",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"The parent extension SHOULD be aliased as ",(0,i.yg)("inlineCode",{parentName:"li"},"ParentRequest"),"."))),(0,i.yg)("li",{parentName:"ul"},"MUST have a public ",(0,i.yg)("inlineCode",{parentName:"li"},"rules")," method, returning an array of validation rules."),(0,i.yg)("li",{parentName:"ul"},"MUST have a public ",(0,i.yg)("inlineCode",{parentName:"li"},"authorize")," method, returning a boolean value.")))),(0,i.yg)("h2",{id:"folder-structure"},"Folder Structure"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-markdown"},"app\n\u2514\u2500\u2500 Containers\n    \u2514\u2500\u2500 Section\n        \u2514\u2500\u2500 Container\n            \u2514\u2500\u2500 UI\n                \u251c\u2500\u2500 API\n                \u2502   \u2514\u2500\u2500 Requests\n                \u2502       \u251c\u2500\u2500 CreateUserRequest.php\n                \u2502       \u251c\u2500\u2500 DeleteUserRequest.php\n                \u2502       \u2514\u2500\u2500 ...\n                \u2514\u2500\u2500 WEB\n                    \u2514\u2500\u2500 Requests\n                        \u251c\u2500\u2500 Login.php\n                        \u251c\u2500\u2500 Logout.php\n                        \u2514\u2500\u2500 ...\n")),(0,i.yg)("h2",{id:"code-example"},"Code Example"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"use App\\Ship\\Parents\\Requests\\Request as ParentRequest;\n\nclass DemoRequest extends ParentRequest\n{\n    protected array $access = [];\n    protected array $decode = [];\n    protected array $urlParameters = [];\n\n    public function rules(): array\n    {\n        return [\n            'field' => 'min:3|max:50',\n        ];\n    }\n\n    public function authorize(): bool\n    {\n        return true;\n    }\n}\n")),(0,i.yg)("h2",{id:"validation"},"Validation"),(0,i.yg)("p",null,"In Apiato,\nvalidation of incoming requests follows the\nLaravel ",(0,i.yg)("a",{parentName:"p",href:"https://laravel.com/docs/validation#form-request-validation"},"Form Request Validation")," approach."),(0,i.yg)("p",null,"Validation rules are defined within the respective Request class.\nThese rules are automatically enforced when a Request is injected into a Controller."),(0,i.yg)("p",null,"Here's an example of a Request class with validation rules:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"use App\\Ship\\Parents\\Requests\\Request as ParentRequest;\n\nclass RegisterUserRequest extends ParentRequest\n{\n    public function rules(): array\n    {\n        return [\n            'email'    => 'required|email|max:200|unique:users,email',\n            'password' => 'required|min:20|max:300',\n            'name'     => ['required', 'min:2', 'max:400'],\n        ];\n    }\n\n}\n")),(0,i.yg)("p",null,"And here's how you would use this Request class within a Controller:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"public function __invoke(RegisterUserRequest $request)\n{\n    $user = app(RegisterUserAction::class)->run($request);\n    \n    return $this->transform($user, UserTransformer::class);\n}\n")),(0,i.yg)("p",null,"In this example,\nthe validation rules defined in ",(0,i.yg)("inlineCode",{parentName:"p"},"RegisterUserRequest")," will be automatically applied\nbefore the ",(0,i.yg)("inlineCode",{parentName:"p"},"__invoke")," method is executed.\nIf the validation fails, an appropriate error response will be generated."),(0,i.yg)("h2",{id:"request-properties"},"Request Properties"),(0,i.yg)("p",null,"Apiato introduces new properties to the Request Class that enhance its functionality."),(0,i.yg)("h3",{id:"access"},"access"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"$access")," property allows you to define Roles and Permissions that can access a specific endpoint.\nIt's used by the ",(0,i.yg)("inlineCode",{parentName:"p"},"hasAccess")," method to check if a user has the required Roles and Permissions to use that endpoint."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"class DemoRequest extends ParentRequest\n{\n    protected array $access = [\n        'permissions' => 'delete-users',\n        'roles' => 'manager'\n    ];\n\n    public function authorize(): bool\n    {\n        return $this->check([\n            'hasAccess',\n        ]);\n    }\n}\n")),(0,i.yg)("p",null,"You can also use the ",(0,i.yg)("inlineCode",{parentName:"p"},"array notation")," or ",(0,i.yg)("inlineCode",{parentName:"p"},"pipe")," to define multiple Roles and Permissions."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"class DemoRequest extends ParentRequest\n{\n    protected $access = [\n        'permissions' => ['delete-users', 'another-permissions'],\n        'roles' => 'manager|admin',\n    ];\n        \n    // ...\n}\n")),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"If there's no need to set any roles or permissions,\nyou can simply set the ",(0,i.yg)("inlineCode",{parentName:"p"},"$permissions")," or ",(0,i.yg)("inlineCode",{parentName:"p"},"$roles")," property to an empty string ",(0,i.yg)("inlineCode",{parentName:"p"},"''"),", an empty array ",(0,i.yg)("inlineCode",{parentName:"p"},"[]"),", or ",(0,i.yg)("inlineCode",{parentName:"p"},"null"),".")),(0,i.yg)("h3",{id:"decode"},"decode"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"$decode")," property is used to handle the decoding of Hashed IDs from the incoming Request."),(0,i.yg)("p",null,"When you enable the ",(0,i.yg)("a",{parentName:"p",href:"/docs/next/security/hash-id"},"Hash ID")," feature, your application can receive Hashed IDs from users.\nThese Hashed IDs need to be decoded before they can be effectively validated.\nApiato facilitates this process\nby providing a property in its Requests class where you can specify which Hashed IDs need to be decoded.\nThis ensures that the validation procedure seamlessly integrates with Hashed IDs."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"class DemoRequest extends ParentRequest\n{\n    protected array $decode = [\n        'user_id',\n        'item_id',\n    ];\n    \n    // ...\n}\n")),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("p",{parentName:"admonition"},"Keep in mind that validation rules relying on your ID, such as ",(0,i.yg)("inlineCode",{parentName:"p"},"exists:users,id"),",\nwill not function correctly unless you decode the ID before passing it to the validation process.")),(0,i.yg)("h3",{id:"urlparameters"},"urlParameters"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"$urlParameters")," property simplifies the process of applying validation rules to URL parameters."),(0,i.yg)("p",null,"By default, Laravel doesn't provide validation for URL parameters (",(0,i.yg)("inlineCode",{parentName:"p"},"/stores/999/items"),").\nHowever, by using the ",(0,i.yg)("inlineCode",{parentName:"p"},"$urlParameters")," property, you can enable validation for these parameters.\nBy specifying the desired URL parameters within this property,\nyou not only enable validation but also gain direct access to these parameters from the Request object."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"// URL: /stores/{id}/items\n// GET /stores/999/items\nclass DemoRequest extends ParentRequest\n{\n    protected array $urlParameters = [\n        'id',\n    ];\n\n    public function rules(): array\n    {\n        return [\n            'id'   => 'integer', // url parameter\n        ];\n    }\n}\n")),(0,i.yg)("h2",{id:"helper-methods"},"Helper Methods"),(0,i.yg)("h3",{id:"check"},"check"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"check")," method is used to authorize the user to access the endpoint.\nIt accepts an array of methods names that will be called to check if the user has access or not.\nEach of those methods must return a boolean.\nTake a look at the following example:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"use App\\Ship\\Parents\\Requests\\Request as ParentRequest;\n\nclass DemoRequest extends ParentRequest\n{\n    use IsAuthorTrait;\n\n    // ...\n\n    public function authorize(): bool\n    {\n        return $this->check([\n            'hasAccess|isOwner',\n            'isKing',\n        ]);\n    }\n}\n")),(0,i.yg)("p",null,"Here we are passing the the ",(0,i.yg)("inlineCode",{parentName:"p"},"hasAccess"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"isOwner")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"isKing")," methods to the ",(0,i.yg)("inlineCode",{parentName:"p"},"check")," method.\nThen the ",(0,i.yg)("inlineCode",{parentName:"p"},"check")," method follows the following rules and checks if the user has access or not:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"The separator ",(0,i.yg)("inlineCode",{parentName:"li"},"|")," between the methods indicates an ",(0,i.yg)("inlineCode",{parentName:"li"},"OR")," operation."),(0,i.yg)("li",{parentName:"ul"},"The default operation between all methods in the array is ",(0,i.yg)("inlineCode",{parentName:"li"},"AND"),".")),(0,i.yg)("p",null,"So in the above example, the call to the ",(0,i.yg)("inlineCode",{parentName:"p"},"check")," method will be translated to:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"return ($this->hasAccess() || $this->isOwner()) && $this->isKing();\n")),(0,i.yg)("p",null,"And if the result of this operation is ",(0,i.yg)("inlineCode",{parentName:"p"},"true")," then the user will be authorized to access the endpoint."),(0,i.yg)("admonition",{type:"note"},(0,i.yg)("ul",{parentName:"admonition"},(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"hasAccess")," method is a ",(0,i.yg)("a",{parentName:"li",href:"#hasaccess"},"built-in authorization method"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"isOwner")," and ",(0,i.yg)("inlineCode",{parentName:"li"},"isKing")," methods are ",(0,i.yg)("a",{parentName:"li",href:"#custom-authorize-methods"},"custom authorization methods")))),(0,i.yg)("h3",{id:"hasaccess"},"hasAccess"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"hasAccess")," method assesses a user's access rights based on the Request's ",(0,i.yg)("inlineCode",{parentName:"p"},"$access")," property.\nIf the user has any of the specified Roles or Permissions, the method will return ",(0,i.yg)("inlineCode",{parentName:"p"},"true")," otherwise it will\nreturn ",(0,i.yg)("inlineCode",{parentName:"p"},"false"),"."),(0,i.yg)("h3",{id:"sanitizeinput"},"sanitizeInput"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"sanitizeInput")," method is employed to cleanse request data before its utilization within the application."),(0,i.yg)("p",null,"Particularly useful for ",(0,i.yg)("inlineCode",{parentName:"p"},"PATCH")," requests,\nwhere you may want\nto submit only the fields\nintended for modification to minimize traffic or perform partial updates to the corresponding database resource.\nTraditional checks for the presence or absence of specific keys in the request can lead to extensive ",(0,i.yg)("inlineCode",{parentName:"p"},"if")," blocks,\nsuch as:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"if ($request->has('data.name')) {\n   $data['name'] = $request->input('data.name');\n}\n")),(0,i.yg)("p",null,"To circumvent these ",(0,i.yg)("inlineCode",{parentName:"p"},"if")," blocks, you might utilize ",(0,i.yg)("inlineCode",{parentName:"p"},"array_filter($data)")," to remove empty fields from the request.\nHowever, be aware that in PHP, both ",(0,i.yg)("inlineCode",{parentName:"p"},"false")," and an empty string ",(0,i.yg)("inlineCode",{parentName:"p"},"''")," are considered as ",(0,i.yg)("inlineCode",{parentName:"p"},"empty"),"."),(0,i.yg)("p",null,"For streamlining data sanitization when using ",(0,i.yg)("inlineCode",{parentName:"p"},"application/json")," instead of ",(0,i.yg)("inlineCode",{parentName:"p"},"x-www-form-urlencoded"),",\nApiato provides the convenient ",(0,i.yg)("inlineCode",{parentName:"p"},"sanitizeInput")," method."),(0,i.yg)("p",null,"Consider the following request:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "name": "Demo",\n    "description": "Some description",\n    "is_private": false,\n    "address": "",\n    "foo": {\n      "number": 1,\n      "bar": "bar"\n    }\n  },\n  "meta": "some meta data"\n}\n')),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"sanitizeInput")," method enables you to specify a list of fields,\nemploying dot notation, to be accessed and extracted from the request."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"$data = $request->sanitizeInput([\n    'data.description',\n    'data.is_private',\n    'data.address',\n    'data.foo.number',\n    'email', // will be ignored\n    'meta',\n]);\n")),(0,i.yg)("p",null,"The extracted data will appear as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},'[\n  "data" => [\n    "description" => "Some description"\n    "is_private" => false,\n    "address" => null, // empty string is converted to null by Laravel\n    "foo" => [\n      "number" => 1,\n    ]\n  ],\n  "meta" => "some meta data",\n]\n')),(0,i.yg)("p",null,"Note that ",(0,i.yg)("inlineCode",{parentName:"p"},"email")," is excluded from the sanitized array, as it was absent in the request.\nAdditionally, any other fields not specified are omitted.\nIn essence, the method filters the request, retaining only the defined values."),(0,i.yg)("p",null,"You can also assign default values during the data sanitization process:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"$sanitizedData = $request->sanitizeInput([\n    'name' => 'John', // If name is not provided, the default value will be set\n    'product.company.address' => 'Somewhere in the world', // dot notation is supported\n    'email',\n    'password'\n]);\n")),(0,i.yg)("h3",{id:"getinputbykey"},"getInputByKey"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"getInputByKey")," method retrieves data from the ",(0,i.yg)("inlineCode",{parentName:"p"},"request")," by specifying the field name.\nSimilar to ",(0,i.yg)("inlineCode",{parentName:"p"},"$request->input('key.here')"),", this method operates on the ",(0,i.yg)("inlineCode",{parentName:"p"},"decoded")," values instead of the original data."),(0,i.yg)("p",null,"Consider the following request:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "XbPW7awNkzl83LD6"\n}\n')),(0,i.yg)("p",null,"While ",(0,i.yg)("inlineCode",{parentName:"p"},"$request->input('id')")," would return ",(0,i.yg)("inlineCode",{parentName:"p"},'"XbPW7awNkzl83LD6"'),",\n",(0,i.yg)("inlineCode",{parentName:"p"},"$request->getInputByKey('id')")," would return the decoded value\n(e.g., ",(0,i.yg)("inlineCode",{parentName:"p"},"4"),")."),(0,i.yg)("p",null,"Moreover, you can set a ",(0,i.yg)("inlineCode",{parentName:"p"},"default")," value to be returned if the key is absent or unset, like this:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"$request->getInputByKey('data.name', 'Undefined')\n")),(0,i.yg)("h3",{id:"mapinput"},"mapInput"),(0,i.yg)("p",null,"In certain cases, you might need to remap input from the request to different fields.\nWhile manual field mapping is possible, you can also leverage the ",(0,i.yg)("inlineCode",{parentName:"p"},"mapInput"),' method for this purpose.\nThis helper method allows you to "redefine" keys within the request, making subsequent processing easier.'),(0,i.yg)("p",null,"Consider the following request:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "name": "John Doe"\n  }\n}\n')),(0,i.yg)("p",null,"However, for processing purposes, you require the ",(0,i.yg)("inlineCode",{parentName:"p"},"username")," field instead of ",(0,i.yg)("inlineCode",{parentName:"p"},"data.name"),"."),(0,i.yg)("p",null,"You can use the helper as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"$request->mapInput([\n    'data.name' => 'username',\n]);\n")),(0,i.yg)("p",null,"The resulting structure would be:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "username": "John Doe"\n}\n')),(0,i.yg)("p",null,"And you can access the value as follows:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"$request->input('username');\n")),(0,i.yg)("h3",{id:"injectdata"},"injectData"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"injectData")," method allows you to inject data into the request.\nThis can be particularly helpful during testing\nwhen you wish to provide data directly to the request instead of sending it through the request body."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"$request = RegisterUserRequest::injectData($data);\n")),(0,i.yg)("h3",{id:"withurlparameters"},"withUrlParameters"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"withUrlParameters")," method enables you to inject URL parameters into the request.\nThis is especially useful when you need to include properties in the request that are not part of the request body\nbut are required for the request to be processed.\nThis method is often used in conjunction with the ",(0,i.yg)("inlineCode",{parentName:"p"},"injectData")," method."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"$request = RegisterUserRequest::injectData($data)\n    ->withUrlParameters(['id' => 123]);\n")),(0,i.yg)("h2",{id:"custom-authorize-methods"},"Custom Authorize Methods"),(0,i.yg)("p",null,"The recommended approach for adding custom authorization functions is by using a Trait,\nwhich can be included in your Request classes."),(0,i.yg)("p",null,"For instance,\nlet's\ncreate an ",(0,i.yg)("inlineCode",{parentName:"p"},"IsAuthorTrait")," Trait with a single method\nnamed ",(0,i.yg)("inlineCode",{parentName:"p"},"isAuthor")," to determine if the current user holds the role of an author."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"trait IsAuthorTrait\n{\n    public function isAuthor(): bool\n    {\n        return $this->user()->hasRole('author');\n    }\n}\n")),(0,i.yg)("p",null,"Subsequently, you can apply the ",(0,i.yg)("inlineCode",{parentName:"p"},"IsAuthorTrait")," Trait to a Request class,\nallowing the utilization of the ",(0,i.yg)("inlineCode",{parentName:"p"},"isAuthor")," function within the authorization process."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"use App\\Ship\\Parents\\Requests\\Request as ParentRequest;\n\nclass DemoRequest extends ParentRequest\n{\n    use IsAuthorTrait;\n\n    // ...\n\n    public function authorize(): bool\n    {\n        return $this->check([\n            'isAuthor',\n        ]);\n    }\n}\n")),(0,i.yg)("h2",{id:"bypass-authorization"},"Bypass Authorization"),(0,i.yg)("p",null,"To grant certain Roles access to all endpoints within the system without the need\nto define the role in each Request object,\nyou can follow this approach.\nThis is particularly beneficial when you want to provide unrestricted access to users with the ",(0,i.yg)("inlineCode",{parentName:"p"},"admin")," role.\nTo implement this, define the relevant roles in ",(0,i.yg)("inlineCode",{parentName:"p"},"app/Ship/Configs/apiato.php")," as shown below:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-php"},"'requests' => [\n    'allow-roles-to-access-all-routes' => ['admin'],\n],\n")),(0,i.yg)("h2",{id:"force-accept-header"},"Force Accept Header"),(0,i.yg)("p",null,"Typically, when making calls to a JSON API, you should include the ",(0,i.yg)("inlineCode",{parentName:"p"},"accept: application/json")," HTTP header.\nIn Apiato, you have the option to either enforce users to send this header or allow them to skip it."),(0,i.yg)("p",null,"To enforce the ",(0,i.yg)("inlineCode",{parentName:"p"},"accept: application/json")," header,\nnavigate to the ",(0,i.yg)("inlineCode",{parentName:"p"},"app/Ship/Configs/apiato.php")," configuration file and set the ",(0,i.yg)("inlineCode",{parentName:"p"},"force-accept-header")," to ",(0,i.yg)("inlineCode",{parentName:"p"},"true"),"."),(0,i.yg)("p",null,"Conversely, if you wish to allow users to skip this header, set ",(0,i.yg)("inlineCode",{parentName:"p"},"force-accept-header")," to ",(0,i.yg)("inlineCode",{parentName:"p"},"false"),"."),(0,i.yg)("admonition",{type:"info"},(0,i.yg)("p",{parentName:"admonition"},"Forcing the accept header is disabled by default.")),(0,i.yg)("h2",{id:"etag"},"Etag"),(0,i.yg)("p",null,"The ",(0,i.yg)("strong",{parentName:"p"},"ETag")," or ",(0,i.yg)("strong",{parentName:"p"},"entity tag")," is part of HTTP, the protocol for the World Wide Web.\nIt is one of several mechanisms that HTTP provides for Web cache validation,\nwhich allows a client to make conditional requests.\nThis mechanism allows caches to be more efficient and saves bandwidth,\nas a Web server does not need to send a full response if the content has not changed.\n(",(0,i.yg)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/HTTP_ETag"},"Wikipedia"),")"),(0,i.yg)("p",null,"Apiato offers support for Etag through the ",(0,i.yg)("inlineCode",{parentName:"p"},"Apiato\\Core\\Middlewares\\HttpProcessETagHeadersMiddleware")," middleware,\nwhich employs the Shallow technique.\nThis middleware can be particularly valuable in reducing bandwidth usage for clients, especially on mobile devices."),(0,i.yg)("p",null,"Please note that this feature is ",(0,i.yg)("strong",{parentName:"p"},"disabled by default"),". To enable it, follow these steps:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},"Navigate to the ",(0,i.yg)("inlineCode",{parentName:"li"},"app/Ship/Configs/apiato.php")," configuration file."),(0,i.yg)("li",{parentName:"ol"},"Inside the configuration file, locate the ",(0,i.yg)("inlineCode",{parentName:"li"},"use-etag")," configuration parameter."),(0,i.yg)("li",{parentName:"ol"},"Set the ",(0,i.yg)("inlineCode",{parentName:"li"},"use-etag")," parameter to ",(0,i.yg)("inlineCode",{parentName:"li"},"true"),".")),(0,i.yg)("p",null,"Keep in mind that for this feature to function correctly, the client must include the ",(0,i.yg)("inlineCode",{parentName:"p"},"If-None-Match")," HTTP header,\nwhich corresponds to the ETag value, in their request."))}c.isMDXComponent=!0}}]);