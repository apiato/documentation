"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[4315],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,h=u["".concat(p,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(h,s(s({ref:t},c),{},{components:n})):a.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[u]="string"==typeof e?e:r,s[1]=i;for(var l=2;l<o;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7494:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const o={title:"Transporters"},s=void 0,i={unversionedId:"main-components/transporters",id:"version-9.x/main-components/transporters",title:"Transporters",description:"- Definition & Principles",source:"@site/versioned_docs/version-9.x/main-components/transporters.md",sourceDirName:"main-components",slug:"/main-components/transporters",permalink:"/docs/9.x/main-components/transporters",draft:!1,editUrl:"https://github.com/apiato/documentation/tree/master/versioned_docs/version-9.x/main-components/transporters.md",tags:[],version:"9.x",lastUpdatedBy:"Mehrdad Amini",lastUpdatedAt:1687327943,formattedLastUpdatedAt:"Jun 21, 2023",frontMatter:{title:"Transporters"},sidebar:"version-9.x/docs",previous:{title:"Requests",permalink:"/docs/9.x/main-components/requests"},next:{title:"Actions",permalink:"/docs/9.x/main-components/actions"}},p={},l=[{value:"Definition &amp; Principles",id:"definition-principles",level:3},{value:"Rules",id:"rules",level:3},{value:"Folder Structure",id:"folder-structure",level:3},{value:"Code Sample",id:"code-sample",level:3},{value:"Optionally switch between Requests and Transporters",id:"requests-and-transporters",level:3},{value:"Transforming a Request to a Transporter",id:"transforming-a-request-to-a-transporter",level:4},{value:"Set Data",id:"set-data",level:3},{value:"Set Instance",id:"set-instance",level:4},{value:"Get Instance:",id:"get-instance",level:4},{value:"Get Data",id:"get-data",level:3}],c={toc:l},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#definition-principles"},"Definition & Principles")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#rules"},"Rules")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#folder-structure"},"Folder Structure")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#code-sample"},"Code Sample")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#requests-and-transporters"},"Requests and Transporters")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#set-data"},"Set Data")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#get-data"},"Get Data"))),(0,r.kt)("h3",{id:"definition-principles"},"Definition & Principles"),(0,r.kt)("p",null,"Transporters is a name chosen by Apiato for DTO's (Data Transfer Objects).\nTransporters are used to pass user data (coming from Requests, Commands, or other places) from place to another (Actions to Tasks / Controller to Action / Command to Action / ...)."),(0,r.kt)("p",null,"They are very useful for reducing the number of parameters in functions, which prevents the duplication of the long parameters.   "),(0,r.kt)("p",null,"Apiato uses ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fireproofsocks/dto"},"this package")," for the DTO. Refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fireproofsocks/dto/wiki"},"dto package wiki")," for more details."),(0,r.kt)("h3",{id:"rules"},"Rules"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"All Models MUST extend from ",(0,r.kt)("inlineCode",{parentName:"li"},"App\\Ship\\Parents\\Transporters\\Transporter"),".")),(0,r.kt)("h3",{id:"folder-structure"},"Folder Structure"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," - App\n    - Containers\n        - {container-name}\n            - Data\n                - Transporters\n                    - CreateUserTransporter.php\n                    - ...\n")),(0,r.kt)("h3",{id:"code-sample"},"Code Sample"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Transporter class")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace App\\Containers\\Authentication\\Transporters;\n\nuse App\\Ship\\Parents\\Transporters\\Transporter;\n\nclass ProxyApiLoginTransporter extends Transporter\n{\n\n    /**\n     * @var array\n     */\n    protected $schema = [\n        'properties' => [\n            'email',\n            'password',\n            'client_id',\n            'client_password',\n            'grant_type',\n            'scope',\n        ],\n        'required'   => [\n            'email',\n            'password',\n            'client_id',\n            'client_password',\n        ],\n        'default'    => [\n            'scope' => '',\n        ]\n    ];\n}\n\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Usage from Controller")),(0,r.kt)("p",null,"Normally you would use it like this"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$dataTransporter = new DataTransporter($request);\n$dataTransporter->bearerToken = $request->bearerToken();\n\nApiato::call('Authentication@ApiLogoutAction', [$dataTransporter]);\n")),(0,r.kt)("p",null,"Since this example above has some required data, that data must be sent to the constructor:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$dataTransporter = new ProxyApiLoginTransporter(\n    array_merge($request->all(), [\n        'client_id'       => Config::get('authentication-container.clients.web.admin.id'),\n        'client_password' => Config::get('authentication-container.clients.web.admin.secret')\n    ])\n);\n\n$result = Apiato::call('Authentication@ProxyApiLoginAction', [$dataTransporter]);\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Creating a Transporter from Test")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$data = [\n    'foo' => 'bar'\n];\n\n$transporter = new DataTransporter($data);\n$action = App::make(RegisterUserAction::class);\n\n$user = $action->run($transporter);\n")),(0,r.kt)("h3",{id:"requests-and-transporters"},"Optionally switch between Requests and Transporters"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// if you have the following function signature\npublic function run(DataTransporter $data)\n\n// you would pass a DataTransporter to it\n$user = Apiato::call('MyContainer@myAction', [new DataTransporter($request)]);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// if you have the following function signature\npublic function run(Request $data)\n\n// you would pass a Request to it\n$user = Apiato::call('MyContainer@myAction', [$request]);\n\n// if request has Transporter defined on it, it will be the one passed to the Action. So the Action can even type hint the custom Transporter defined on the Request.\n")),(0,r.kt)("p",null,"Here where the magic happens:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// if you have the following function signature\npublic function run(Request $data)\n\n// you can pass a DataTransporter to it, only if you are using the magical call function, for the magic to work\n$user = Apiato::call('MyContainer@myAction', [new DataTransporter($request)]);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// if you have the following function signature\npublic function run(DataTransporter $data)\n\n// you can pass a DataTransporter to it, only if you are using the magical call function, for the magic to work\n$user = Apiato::call('MyContainer@myAction', [$request]);\n\n// if request has Transporter defined on it, it will be the one passed to the Action. So the Action can even type hint the custom Transporter defined on the Request.\n")),(0,r.kt)("h4",{id:"transforming-a-request-to-a-transporter"},"Transforming a Request to a Transporter"),(0,r.kt)("p",null,"If you want to directly transform a ",(0,r.kt)("inlineCode",{parentName:"p"},"Request")," to a ",(0,r.kt)("inlineCode",{parentName:"p"},"Transporter")," you can simply call"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$transporter = $request->toTransporter();\n")),(0,r.kt)("p",null,"This method does take the ",(0,r.kt)("inlineCode",{parentName:"p"},"protected $transporter")," of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Request")," class into account. If none is defined, a regular ",(0,r.kt)("inlineCode",{parentName:"p"},"DataTransporter")," will be created."),(0,r.kt)("p",null,"Note, that ",(0,r.kt)("inlineCode",{parentName:"p"},"$transporter")," will now have all fields from ",(0,r.kt)("inlineCode",{parentName:"p"},"$request")," - so you can directly access them. In order to do so,\nyou can call:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// \"simple\" access via direct properties\n$name = $transporter->name;\n\n// complex access via method\n$username = $transporter->getInputByKey('your.nested.username.field');\n")),(0,r.kt)("p",null,'Of course, you can also "sanitize" the data, like you would have done in the ',(0,r.kt)("inlineCode",{parentName:"p"},"Request")," classes by using ",(0,r.kt)("inlineCode",{parentName:"p"},"sanitizeInput(array)"),"."),(0,r.kt)("p",null,"Finally, if you need to access the original ",(0,r.kt)("inlineCode",{parentName:"p"},"Request")," object, you can access it via"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$originalRequest = $transporter->request;\n")),(0,r.kt)("h3",{id:"set-data"},"Set Data"),(0,r.kt)("p",null,"You can set data in many ways"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$dataTransporter = new DataTransporter($request);\n$dataTransporter->bearerToken = $request->bearerToken();\n")),(0,r.kt)("p",null,"If the data is defined as required like this on the Transporter:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"    protected $schema = [\n        'type' => 'object',\n        'properties' => [\n            'email',\n            'password',\n            'clientId',\n            'clientPassword',\n        ],\n        'required'   => [\n            'email',\n            'password',\n            'clientId',\n            'clientPassword',\n        ],\n    ];\n")),(0,r.kt)("p",null,"Then can set data on the Transporter like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$dataTransporter = new ProxyApiLoginTransporter(\n    array_merge($request->all(), [\n        'clientId'       => Config::get('authentication-container.clients.web.admin.id'),\n        'clientPassword' => Config::get('authentication-container.clients.web.admin.secret')\n    ])\n);\n")),(0,r.kt)("h4",{id:"set-instance"},"Set Instance"),(0,r.kt)("p",null,"Passing Objects does not work!, because the third party package cannot hydrate it. So to pass instances from a place to\nanother on the Transporter object, you can do the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$transporter = new DataTransporter();\n$transporter->setInstance("command_instance", $this);\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Warning:")," you can set instances, but they do not appear when calling ",(0,r.kt)("inlineCode",{parentName:"p"},"toArray()")," or other similar functions, since\nthey cannot be hydrated. See below how you can get the instance form the Transporter object."),(0,r.kt)("h4",{id:"get-instance"},"Get Instance:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$console = $data->command_instance;\n")),(0,r.kt)("h3",{id:"get-data"},"Get Data"),(0,r.kt)("p",null,"To get all data from the Transporter you can call ",(0,r.kt)("inlineCode",{parentName:"p"},"$data->toArray()")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"$data->toJson()"),"... there are many other functions on the class."),(0,r.kt)("p",null,"To get specific data just call the data name, as you would when accessing data from a Request object ",(0,r.kt)("inlineCode",{parentName:"p"},"$data->username"),"."))}d.isMDXComponent=!0}}]);