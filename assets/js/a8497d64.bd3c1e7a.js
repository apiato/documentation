"use strict";(self.webpackChunkapiato_documentation=self.webpackChunkapiato_documentation||[]).push([[8030],{75239:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"components/optional-components/middlewares","title":"Middlewares","description":"Apiato middlewares are just Laravel Middlewares,","source":"@site/versioned_docs/version-12.x/components/optional-components/middlewares.md","sourceDirName":"components/optional-components","slug":"/components/optional-components/middlewares","permalink":"/docs/components/optional-components/middlewares","draft":false,"unlisted":false,"editUrl":"https://github.com/apiato/documentation/tree/master/versioned_docs/version-12.x/components/optional-components/middlewares.md","tags":[{"inline":true,"label":"component","permalink":"/docs/tags/component"},{"inline":true,"label":"optional-component","permalink":"/docs/tags/optional-component"},{"inline":true,"label":"middleware","permalink":"/docs/tags/middleware"},{"inline":true,"label":"service-provider","permalink":"/docs/tags/service-provider"},{"inline":true,"label":"route","permalink":"/docs/tags/route"},{"inline":true,"label":"controller","permalink":"/docs/tags/controller"},{"inline":true,"label":"request","permalink":"/docs/tags/request"}],"version":"12.x","lastUpdatedBy":"Mohammad Alavi","lastUpdatedAt":1697511591000,"frontMatter":{"title":"Middlewares","tags":["component","optional-component","middleware","service-provider","route","controller","request"]},"sidebar":"tutorialSidebar","previous":{"title":"Mail","permalink":"/docs/components/optional-components/mail"},"next":{"title":"Migrations","permalink":"/docs/components/optional-components/migrations"}}');var d=n(74848),a=n(28453);const s={title:"Middlewares",tags:["component","optional-component","middleware","service-provider","route","controller","request"]},t=void 0,l={},o=[{value:"Rules",id:"rules",level:2},{value:"Folder Structure",id:"folder-structure",level:2},{value:"Code Example",id:"code-example",level:2},{value:"Registering Middleware",id:"registering-middleware",level:2},{value:"Container Middlewares",id:"container-middlewares",level:3},{value:"General Middlewares",id:"general-middlewares",level:3},{value:"Third Party Middlewares",id:"third-party-middlewares",level:3},{value:"Middleware Registration Flow",id:"middleware-registration-flow",level:2}];function c(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(r.p,{children:["Apiato middlewares are just ",(0,d.jsx)(r.a,{href:"https://laravel.com/docs/middleware",children:"Laravel Middlewares"}),",\nand they function in the exact same way as Laravel middlewares.\nHowever, they come with additional rules and conventions specific to Apiato."]}),"\n",(0,d.jsxs)(r.p,{children:["To generate new middlewares\nyou may use the ",(0,d.jsx)(r.code,{children:"apiato:generate:middleware"})," interactive command:"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"php artisan apiato:generate:middleware\n"})}),"\n",(0,d.jsx)(r.h2,{id:"rules",children:"Rules"}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["All container-specific Middlewares:","\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["MUST be placed in the ",(0,d.jsx)(r.code,{children:"app/Containers/{Section}/{Container}/Middlewares"})," directory."]}),"\n",(0,d.jsxs)(r.li,{children:["MUST be registered in their respective container's ",(0,d.jsx)(r.code,{children:"App\\Containers\\{Section}\\{Container}\\Providers\\MiddlewareServiceProvider"})," class."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(r.li,{children:["All general Middlewares:","\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["MUST be placed in the ",(0,d.jsx)(r.code,{children:"app/Ship/Middlewares"})," directory."]}),"\n",(0,d.jsxs)(r.li,{children:["MUST be registered in the ",(0,d.jsx)(r.code,{children:"App\\Ship\\Kernels\\HttpKernel"})," class."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(r.li,{children:["All non-Laravel or third-party package Middlewares MUST extend the ",(0,d.jsx)(r.code,{children:"App\\Ship\\Parents\\Middlewares\\Middleware"})," class.","\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["The parent extension SHOULD be aliased as ",(0,d.jsx)(r.code,{children:"ParentMiddleware"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(r.h2,{id:"folder-structure",children:"Folder Structure"}),"\n",(0,d.jsx)(r.p,{children:"The highlighted sections showcase middleware registration points:"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-php",children:"app\n\u251c\u2500\u2500 Containers\n\u2502   \u2514\u2500\u2500 Section\n\u2502       \u2514\u2500\u2500 Container\n\u2502           \u251c\u2500\u2500 Middlewares\n\u2502           \u2502   \u251c\u2500\u2500 DemoMiddleware.php\n\u2502           \u2502   \u2514\u2500\u2500 ...\n\u2502           \u2514\u2500\u2500 Providers\n                // highlight-start\n\u2502               \u251c\u2500\u2500 MiddlewareServiceProvider.php\n                // highlight-end\n\u2502               \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 Ship\n    \u251c\u2500\u2500 Kernels\n        // highlight-start\n    \u2502   \u2514\u2500\u2500 HttpKernel.php\n        // highlight-end\n    \u2514\u2500\u2500 Middlewares\n        \u251c\u2500\u2500 AnotherMiddleware.php\n        \u2514\u2500\u2500 ...\n"})}),"\n",(0,d.jsx)(r.h2,{id:"code-example",children:"Code Example"}),"\n",(0,d.jsx)(r.p,{children:"Middlewares are defined exactly as you would define them in Laravel."}),"\n",(0,d.jsx)(r.h2,{id:"registering-middleware",children:"Registering Middleware"}),"\n",(0,d.jsx)(r.p,{children:"The registration process for a middleware varies depending on its intended scope within the application.\nDifferent places are designated for different levels of middleware usage."}),"\n",(0,d.jsx)(r.p,{children:"In essence, the decision of where to register a middleware boils down to two key factors:\nthe scope of middleware usage and the logical location for its registration."}),"\n",(0,d.jsx)(r.h3,{id:"container-middlewares",children:"Container Middlewares"}),"\n",(0,d.jsxs)(r.p,{children:["If a middleware usage is specific to a container,\nit must be registered in the ",(0,d.jsx)(r.code,{children:"App\\Containers\\{Section}\\{Container}\\Providers\\MiddlewareServiceProvider"})," class."]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-php",children:"use ...\nuse App\\Ship\\Parents\\Providers\\MiddlewareServiceProvider as ParentMiddlewareServiceProvider;\n\nclass MiddlewareServiceProvider extends ParentMiddlewareServiceProvider\n{\n    protected array $middlewares = [];\n    protected array $middlewareGroups = [];\n    protected array $middlewarePriority = [];\n    protected array $middlewareAliases = [];\n}\n"})}),"\n",(0,d.jsxs)(r.p,{children:["To generate a middleware service provider\nyou may use the ",(0,d.jsx)(r.code,{children:"apiato:generate:provider"})," interactive command:"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{children:"php artisan apiato:generate:provider\n"})}),"\n",(0,d.jsxs)(r.p,{children:["Remember to also register the ",(0,d.jsx)(r.code,{children:"MiddlewareServiceProvider"})," in the container's ",(0,d.jsx)(r.code,{children:"MainServiceProvider"}),":"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-php",children:"use ...\nuse App\\Ship\\Parents\\Providers\\MainServiceProvider as ParentMainServiceProvider;\n\nclass MainServiceProvider extends ParentMainServiceProvider\n{\n    protected array $serviceProviders = [\n        // ... Other service providers\n        MiddlewareServiceProvider::class,\n    ];\n}\n"})}),"\n",(0,d.jsx)(r.h3,{id:"general-middlewares",children:"General Middlewares"}),"\n",(0,d.jsxs)(r.p,{children:["General middlewares must be registered in the ",(0,d.jsx)(r.code,{children:"App\\Ship\\Kernels\\HttpKernel"})," class."]}),"\n",(0,d.jsx)(r.h3,{id:"third-party-middlewares",children:"Third Party Middlewares"}),"\n",(0,d.jsxs)(r.p,{children:["When dealing with third-party packages that require middleware registration in the ",(0,d.jsx)(r.code,{children:"App\\Ship\\Kernels\\HttpKernel"})," class,\nyou should follow these guidelines:"]}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"Specific Container Usage"}),": If the package is used within a particular container, register its middleware in that container ",(0,d.jsx)(r.code,{children:"App\\Containers\\{Section}\\{Container}\\Providers\\MiddlewareServiceProvider"})," class."]}),"\n"]}),"\n",(0,d.jsxs)(r.li,{children:["\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"Framework-wide Usage"}),": If the package is generic and used throughout the entire application, you can register its middleware in the ",(0,d.jsx)(r.code,{children:"App\\Ship\\Kernels\\HttpKernel"})," class."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(r.h2,{id:"middleware-registration-flow",children:"Middleware Registration Flow"}),"\n",(0,d.jsx)(r.p,{children:"If you want to understand the middleware registration process,\nhere is a breakdown of the registration flow."}),"\n",(0,d.jsx)(r.p,{children:"Consider the following folder structure:"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-php",children:"app\n\u251c\u2500\u2500 Containers\n\u2502   \u2514\u2500\u2500 Section\n\u2502       \u2514\u2500\u2500 Container\n\u2502           \u251c\u2500\u2500 Middlewares\n\u2502           \u2502   \u251c\u2500\u2500 DemoMiddleware.php \u2500\u25ba\u2500\u2510\n\u2502           \u2502   \u2514\u2500\u2500 ...                   \u2502\n\u2502           \u2514\u2500\u2500 Providers                 \u25bc\n\u2502               \u251c\u2500\u2500 MiddlewareServiceProvider.php \u2500\u2500\u2500\u2500\u2500\u25ba\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               \u251c\u2500\u2500 MainServiceProvider.php \u25c4\u2500registered\u2500in\u2500\u25c4\u2518\n\u2502               \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 Ship\n    \u251c\u2500\u2500 Kernels\n    \u2502   \u251c\u2500\u2500 HttpKernel.php \u25c4\u2500registered\u2500in\u2500\u25c4\u2510\n    \u2502   \u2514\u2500\u2500 ...                             \u2502\n    \u2514\u2500\u2500 Middlewares                         \u2502\n        \u251c\u2500\u2500 AnotherMiddleware.php \u2500\u2500\u2500\u2500\u2500\u25ba\u2500\u2500\u2500\u2500\u2518\n        \u2514\u2500\u2500 ...\n"})}),"\n",(0,d.jsx)(r.p,{children:"The following diagram illustrates the registration flow of middlewares in the above folder structure:"}),"\n",(0,d.jsx)(r.mermaid,{value:"graph LR\n  subgraph Container\n    MainServiceProvider\n    MiddlewareServiceProvider\n    DemoMiddleware\n  end\n  \n  MainServiceProvider --\x3e|loads| MiddlewareServiceProvider\n  MiddlewareServiceProvider --\x3e|registered in| MainServiceProvider\n  DemoMiddleware --\x3e|registered in| MiddlewareServiceProvider\n  \n  subgraph Ship\n    HttpKernel\n    ShipDemoMiddleware\n  end\n\n  subgraph Application\n    SPLoader[[Service Provider Loader]]-- loads--\x3eMainServiceProvider\n    SPLoader-- loads--\x3eHttpKernel\n  end\n  \n  HttpKernel --\x3e|loads| ShipDemoMiddleware\n  ShipDemoMiddleware --\x3e|registered in| HttpKernel"})]})}function p(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>t});var i=n(96540);const d={},a=i.createContext(d);function s(e){const r=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),i.createElement(a.Provider,{value:r},e.children)}}}]);