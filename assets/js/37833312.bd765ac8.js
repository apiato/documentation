"use strict";(self.webpackChunkapiato_documentation=self.webpackChunkapiato_documentation||[]).push([[7785],{27681:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var t=s(74848),r=s(28453);const i={title:"Requests"},o=void 0,a={id:"main-components/requests",title:"Requests",description:"* Definition & Principles",source:"@site/versioned_docs/version-9.x/main-components/requests.md",sourceDirName:"main-components",slug:"/main-components/requests",permalink:"/docs/9.x/main-components/requests",draft:!1,unlisted:!1,editUrl:"https://github.com/apiato/documentation/tree/master/versioned_docs/version-9.x/main-components/requests.md",tags:[],version:"9.x",lastUpdatedBy:"Moslem Deris",lastUpdatedAt:1659346629e3,frontMatter:{title:"Requests"},sidebar:"docs",previous:{title:"Controllers",permalink:"/docs/9.x/main-components/controllers"},next:{title:"Transporters",permalink:"/docs/9.x/main-components/transporters"}},c={},l=[{value:"Definition &amp; Principles",id:"definition-principles",level:3},{value:"Rules",id:"rules",level:3},{value:"Folder Structure",id:"folder-structure",level:3},{value:"Code Samples",id:"code-samples",level:3},{value:"Request Properties",id:"request-properties",level:2},{value:"<strong>decode</strong>",id:"decode",level:3},{value:"<strong>urlParameters</strong>",id:"urlparameters",level:3},{value:"<strong>access</strong>",id:"access",level:3},{value:"How the authorize function work",id:"how-the-authorize-function-work",level:2},{value:"Add Custom Authorize Functions",id:"custom-authorize-functions",level:3},{value:"Allow a Role to access every endpoint",id:"allow-a-role-to-access-every-endpoint",level:2},{value:"Request Helper Functions",id:"request-helper-functions",level:2},{value:"<strong>hasAccess</strong>",id:"hasaccess",level:3},{value:"<strong>isOwner</strong>",id:"isowner",level:3},{value:"<strong>getInputByKey</strong>",id:"getinputbykey",level:3},{value:"<strong>sanitizeInput</strong>",id:"sanitizeinput",level:3},{value:"<strong>mapInput</strong>",id:"mapinput",level:3},{value:"Storing Data on the Request",id:"storing-data-on-the-request",level:2},{value:"Unit Testing for Actions (Request)",id:"unit-testing-for-actions-request",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#definition-principles",children:"Definition & Principles"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#rules",children:"Rules"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#folder-structure",children:"Folder Structure"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#code-samples",children:"Code Samples"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#request-properties",children:"Request Properties"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#decode",children:"decode"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#urlparameters",children:"urlParameters"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#access",children:"access"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#how-the-authorize-function-work",children:"How the authorize function work"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#custom-authorize-functions",children:"Add Custom Authorize Functions"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#allow-a-role-to-access-every-endpoint",children:"Allow a Role to access every endpoint"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#request-helper-functions",children:"Request Helper Functions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#hasaccess",children:"hasAccess"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#isowner",children:"isOwner"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getinputbykey",children:"getInputByKey"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#sanitizeinput",children:"sanitizeInput"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#mapinput",children:"mapInput"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#storing-data-on-the-request",children:"Storing Data on the Request"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#unit-testing-for-actions-request",children:"Unit Testing for Actions (Request)"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"definition-principles",children:"Definition & Principles"}),"\n",(0,t.jsxs)(n.p,{children:["Read from the ",(0,t.jsx)(n.a,{href:"https://github.com/Mahmoudz/Porto#Requests",children:(0,t.jsx)(n.strong,{children:"Porto SAP Documentation (#Requests)"})}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"rules",children:"Rules"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["All Requests MUST extend from ",(0,t.jsx)(n.code,{children:"App\\Ship\\Parents\\Requests\\Request"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["A Request MUST have a ",(0,t.jsx)(n.code,{children:"rules()"})," function, returning an array and ",(0,t.jsx)(n.code,{children:"authorize()"})," function to check for authorization (can return true when no authorization required)."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"folder-structure",children:"Folder Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" - app\n    - Containers\n        - {container-name}\n            - UI\n                - API\n                    - Requests\n                        - UpdateUserRequest.php\n                        - DeleteUserRequest.php\n                        - ...\n                - WEB\n                    - Requests\n                        - UpdateUserRequest.php\n                        - DeleteUserRequest.php\n                        - ...\n"})}),"\n",(0,t.jsx)(n.h3,{id:"code-samples",children:"Code Samples"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example: Update User Requests"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Containers\\User\\UI\\API\\Requests;\n\nuse App\\Ship\\Parents\\Requests\\Request;\n\nclass UpdateUserRequest extends Request\n{\n\n    protected $access = [\n        'permission' => '',\n        'roles'      => 'admin',\n    ];\n\n    protected $decode = [\n\n    ];\n\n    protected $urlParameters = [\n\n    ];\n\n    public function rules()\n    {\n        return [\n            'email'    => 'email|unique:users,email',\n            'password' => 'min:100|max:200',\n            'name'     => 'min:300|max:400',\n        ];\n    }\n\n    public function authorize()\n    {\n        return $this->check([\n            'hasAccess|isOwner',\n        ]);\n    }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"If you are wondering what are those properties doing on the request! keep reading"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Usage from Controller:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\npublic function handle(UpdateUserRequest $updateUserRequest)\n{\n    $data = $updateUserRequest->all();\n    // or\n    $name = $updateUserRequest->name;\n    // or\n    $name = $updateUserRequest['name'];\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"By just injecting the request class you already applied the validation and authorization rules."}),"\n",(0,t.jsx)(n.p,{children:"When you need to pass data to the Action, you should pass the request Object as it is to the Action parameter."}),"\n",(0,t.jsx)(n.h2,{id:"request-properties",children:"Request Properties"}),"\n",(0,t.jsx)(n.p,{children:"apiato adds some new properties to the Request Class. Each of these properties is very useful for some situations, and let you achieve your goals faster and cleaner. Below we'll see description for each property:"}),"\n",(0,t.jsx)(n.h3,{id:"decode",children:(0,t.jsx)(n.strong,{children:"decode"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"$decode"})," property is used for decoding Hashed ID's from any Request on the fly"]}),"\n",(0,t.jsx)(n.p,{children:"If you have enabled the HashID feature, that apiato provide out of the box. Most probably you are passing or allowing your users to pass Hashed (encoded) ID's into your application."}),"\n",(0,t.jsx)(n.p,{children:"Thus, these IDs need to be Decoded somewhere, apiato has a property on its Requests Components where you can specify those Hashed ID's in order to decode them before applying the validation rules."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Containers\\Authorization\\UI\\API\\Requests;\n\nuse App\\Ship\\Parents\\Requests\\Request;\n\nclass AssignUserToRoleRequest extends Request\n{\n\n    protected $decode = [\n        'user_id',\n        'item_id',\n    ];\n\n    public function rules()\n    {\n        return [\n\n        ];\n    }\n\n    public function authorize()\n    {\n        return $this->check([\n            // ..\n        ]);\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note:"})," validations rules that relies on your ID like (",(0,t.jsx)(n.code,{children:"exists:users,id"}),") will not work unless you decode your ID before passing it to the validation."]}),"\n",(0,t.jsx)(n.h3,{id:"urlparameters",children:(0,t.jsx)(n.strong,{children:"urlParameters"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"$urlParameters"})," property is used for applying validation rules on the URL parameters:"]}),"\n",(0,t.jsxs)(n.p,{children:["Laravel by default does not allow validating the URL parameters (",(0,t.jsx)(n.code,{children:"/stores/999/items"}),"). In order to be able to apply validation rules on URL parameters you can simply define your URL parameters in the ",(0,t.jsx)(n.code,{children:"$urlParameters"})," property. This will also allow you to access those parameters form the Controller in the same way you access the Request data."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Containers\\Email\\UI\\API\\Requests;\n\nuse App\\Ship\\Parents\\Requests\\Request;\n\nclass ConfirmUserEmailRequest extends Request\n{\n\n    /**\n     * Defining the URL parameters (`/stores/999/items`) allows applying\n     * validation rules on them and allows accessing them like request data.\n     *\n     * @var  array\n     */\n    protected $urlParameters = [\n        'id',\n        'code',\n    ];\n\n    public function rules()\n    {\n        return [\n            'id'   => 'required|integer', // url parameter\n            'code' => 'required|min:35|max:45', // url parameter\n        ];\n    }\n\n    public function authorize()\n    {\n        return $this->check([\n            // nothing! this is open endpoint.\n        ]);\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"access",children:(0,t.jsx)(n.strong,{children:"access"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"$access"})," property, allows the user to define set of Roles and Permissions than can access this endpoint."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"$access"})," property is used by the ",(0,t.jsx)(n.code,{children:"hasAccess"})," function defined below in the ",(0,t.jsx)(n.code,{children:"authorize"})," function, to check if the user has the necessary Roles & Permissions to call this endpoint (basically access the controller function where this request object is injected)."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace App\\Containers\\User\\UI\\API\\Requests;\n\nuse App\\Ship\\Parents\\Requests\\Request;\n\nclass DeleteUserRequest extends Request\n{\n    /**\n     * Define which Roles and/or Permissions has access to this request.\n     *\n     * @var  array\n     */\n    protected $access = [\n        'permission' => 'delete-users|another-permissions',\n        'roles' => 'manager'\n    ];\n\n    public function authorize()\n    {\n        return $this->check([\n            'hasAccess|isOwner',\n            'isKing',\n        ]);\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you do not like the ",(0,t.jsx)(n.code,{children:"laravelish"})," style with ",(0,t.jsx)(n.code,{children:"|"})," in order to separate the different ",(0,t.jsx)(n.code,{children:"roles"})," or ",(0,t.jsx)(n.code,{children:"permissions"})," (e.g., see the example above),\nyou can also use the ",(0,t.jsx)(n.code,{children:"array notation"}),". The example from above would look like this (only part that changes):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"    protected $access = [\n            'permission' => ['delete-users', 'another-permissions'],\n            'roles' => ['manager'],\n    ];\n"})}),"\n",(0,t.jsx)(n.h2,{id:"how-the-authorize-function-work",children:"How the authorize function work"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"authorize"})," function is calling a ",(0,t.jsx)(n.code,{children:"check"})," function which accepts an array of functions names. Each of those functions returns boolean."]}),"\n",(0,t.jsxs)(n.p,{children:["In the example above we are calling three functions ",(0,t.jsx)(n.code,{children:"hasAccess"}),", ",(0,t.jsx)(n.code,{children:"isOwner"})," and ",(0,t.jsx)(n.code,{children:"isKing"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The separator ",(0,t.jsx)(n.code,{children:"|"})," between the functions indicates an ",(0,t.jsx)(n.code,{children:"OR"})," operation, so if any of the functions ",(0,t.jsx)(n.code,{children:"hasAccess"})," or ",(0,t.jsx)(n.code,{children:"isOwner"})," returns true the user will gain access and only when both return false the user will be prevented from accessing this endpoint."]}),"\n",(0,t.jsxs)(n.p,{children:["On the other side if ",(0,t.jsx)(n.code,{children:"isKing"})," ",(0,t.jsx)(n.em,{children:"(a custom function could be written by you anywhere)"})," returned false no matter what all other functions returns, the user will be prevented from accessing this endpoint, because the default operation between all functions in the array is ",(0,t.jsx)(n.code,{children:"AND"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Checkout the ",(0,t.jsx)(n.a,{href:"https://apiato.readme.io/docs/requests#section-hasaccess",children:"hasAccess"})," below."]}),"\n",(0,t.jsx)(n.h3,{id:"custom-authorize-functions",children:"Add Custom Authorize Functions"}),"\n",(0,t.jsxs)(n.p,{children:["The best way to add a custom authorize function is through a Trait, which can be added to your ",(0,t.jsx)(n.code,{children:"Request"})," classes. In the example below we create a Trait named ",(0,t.jsx)(n.code,{children:"IsAuthorPermissionTrait"})," with a single method called ",(0,t.jsx)(n.code,{children:"isAuthor"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"isAuthor()"})," method, in turn, calls a Task to verify that the current user is an author (e.g., if the user has the proper ",(0,t.jsx)(n.code,{children:"Role"})," assigned)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<?php\nnamespace App\\Containers\\User\\Traits;\n\nuse Apiato\\Core\\Foundation\\Facades\\Apiato;\n\ntrait IsAuthorPermissionTrait\n{\n    public function isAuthor()\n    {\n        // The task needs to be implemented properly!\n        return Apiato::call('User@CheckIfUserHasProperRoleTask', [$this->user(), ['author']]);\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Now, add the newly created Trait to the Request to use the ",(0,t.jsx)(n.code,{children:"isAuthor"})," function in the authorization check."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<?php\n\nnamespace App\\Containers\\User\\UI\\API\\Requests;\n\nuse App\\Containers\\User\\Traits\\IsAuthorPermissionTrait;\nuse App\\Ship\\Parents\\Requests\\Request;\n\nclass FindUserByIdRequest extends Request\n{\n\n    use IsAuthorPermissionTrait;\n\n    // ...\n\n    public function authorize()\n    {\n        return $this->check([\n            'isAuthor',\n        ]);\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Now, the Request uses the newly created ",(0,t.jsx)(n.code,{children:"isAuthor"})," method to check the proper access rights."]}),"\n",(0,t.jsx)(n.h2,{id:"allow-a-role-to-access-every-endpoint",children:"Allow a Role to access every endpoint"}),"\n",(0,t.jsx)(n.p,{children:"You can allow some Roles to access every endpoint in the system without having to define that role in each Request object."}),"\n",(0,t.jsxs)(n.p,{children:["This is useful you want to let users with ",(0,t.jsx)(n.code,{children:"Admin"})," role access everything."]}),"\n",(0,t.jsxs)(n.p,{children:["To do this, define those roles in ",(0,t.jsx)(n.code,{children:"app/Ship/Configs/apiato.php"})," as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"'requests' => [\n    'allow-roles-to-access-all-routes' => ['admin',],\n],\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This will append the ",(0,t.jsx)(n.code,{children:"admin"})," role to all roles access in every request object. Example: this ",(0,t.jsx)(n.code,{children:"'roles' => 'manager'"})," becomes ",(0,t.jsx)(n.code,{children:"'roles' => 'manager|admin'"}),' (if the user is manager or admin "has any of the roles", will be allowed to access the endpoint function).']}),"\n",(0,t.jsx)(n.h2,{id:"request-helper-functions",children:"Request Helper Functions"}),"\n",(0,t.jsx)(n.p,{children:"apiato also provides some helpful functions by default, so you can use them whenever you need them."}),"\n",(0,t.jsx)(n.h3,{id:"hasaccess",children:(0,t.jsx)(n.strong,{children:"hasAccess"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"hasAccess"})," function, decides if user has Access or not based on the ",(0,t.jsx)(n.code,{children:"$access"})," property."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"If the user has any roles or permissions he will be given access."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If you need more or less roles/permissions just add ",(0,t.jsx)(n.code,{children:"|"})," between each permission."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If you do not need to set a roles/permissions just set ",(0,t.jsx)(n.code,{children:"'permission' => ''"})," or  ",(0,t.jsx)(n.code,{children:"'permission' => null"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"isowner",children:(0,t.jsx)(n.strong,{children:"isOwner"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"isOwner"})," function, checks if the passed URL ID is the same as the User ID of the request."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsxs)(n.p,{children:["Let's say we have an endpoint ",(0,t.jsx)(n.code,{children:"www.api.apiato.test/v1/users/{ID}/delete"})," that deletes a user, and we only need users to delete their own user accounts."]}),"\n",(0,t.jsxs)(n.p,{children:["With ",(0,t.jsx)(n.code,{children:"isOwner"}),", user of ID 1 can only call ",(0,t.jsx)(n.code,{children:"/users/1/delete"})," and won't be able to call ",(0,t.jsx)(n.code,{children:"/users/2/delete"})," or any other ID."]}),"\n",(0,t.jsx)(n.h3,{id:"getinputbykey",children:(0,t.jsx)(n.strong,{children:"getInputByKey"})}),"\n",(0,t.jsxs)(n.p,{children:["Get the data from within the ",(0,t.jsx)(n.code,{children:"$request"})," by entering the name of the field. This function behaves like ",(0,t.jsx)(n.code,{children:"$request->input('key.here')"}),",\nhowever, it works on the ",(0,t.jsx)(n.strong,{children:"decoded"})," values instead of the original data."]}),"\n",(0,t.jsxs)(n.p,{children:["Consider the following Request data in case you are passing ",(0,t.jsx)(n.code,{children:"application/json"})," data instead of ",(0,t.jsx)(n.code,{children:"x-www-form-urlencoded"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data" : {\n    "name"  : "foo",\n    "description" : "bar"\n  },\n  "id" : "a2423nadabada0"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Calling ",(0,t.jsx)(n.code,{children:"$request->input('id')"})," would return ",(0,t.jsx)(n.code,{children:'"a2423nadabada0"'}),", however ",(0,t.jsx)(n.code,{children:"$request->getInputByKey('id')"})," would return the\ndecoded value (e.g., ",(0,t.jsx)(n.code,{children:"4"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:["Furthermore, one can define a ",(0,t.jsx)(n.code,{children:"default"})," value to be returned, if the key is not present (or not set), like so:\n",(0,t.jsx)(n.code,{children:"$request->getInputByKey('data.name', 'Undefined')"})]}),"\n",(0,t.jsx)(n.h3,{id:"sanitizeinput",children:(0,t.jsx)(n.strong,{children:"sanitizeInput"})}),"\n",(0,t.jsxs)(n.p,{children:["Especially for ",(0,t.jsx)(n.code,{children:"PATCH"})," requests, if you like to submit only the fields, to be changed to the API in order to:"]}),"\n",(0,t.jsx)(n.p,{children:"a) minimize the traffic\nb) partially update the respective resource"}),"\n",(0,t.jsxs)(n.p,{children:["Checking for the presence (or absence) of specific keys in the request typically results in huge ",(0,t.jsx)(n.code,{children:"if"})," blocks, like so:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"<?php\n// ...\nif($request->has('data.name')) {\n   $data['name'] = $request->input('data.name'); // or use getInputByKey()\n}\nif($request->has('data.description')) {\n   $data['description'] = $request->input('data.description'); // or use getInputByKey()\n}\n// ...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["So to avoid those ",(0,t.jsx)(n.code,{children:"if"})," blocks, use ",(0,t.jsx)(n.code,{children:"array_filter($data)"})," in order to remove ",(0,t.jsx)(n.code,{children:"empty"})," fields from the request."]}),"\n",(0,t.jsxs)(n.p,{children:["However, in PHP ",(0,t.jsx)(n.code,{children:"false"})," and ",(0,t.jsx)(n.code,{children:"''"})," ",(0,t.jsx)(n.em,{children:"(empty string)"})," are also considered as ",(0,t.jsx)(n.code,{children:"empty"})," (which is clearly not what you want)."]}),"\n",(0,t.jsxs)(n.p,{children:["You can read more about this problem ",(0,t.jsx)(n.a,{href:"https://github.com/apiato/apiato/issues/186",children:"here"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["In order to simplify sanitizing ",(0,t.jsx)(n.code,{children:"Request Data"})," when using ",(0,t.jsx)(n.code,{children:"application/json"})," instead of ",(0,t.jsx)(n.code,{children:"x-www-form-urlencoded"}),",\napiato offers a convenient ",(0,t.jsx)(n.code,{children:"sanitizeInput($fields)"})," method."]}),"\n",(0,t.jsx)(n.p,{children:"Consider the following Request data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n\t"data" : {\n\t\t"is_private" : false,\n\t\t"description" : "this is a rather long description text",\n\t\t"a" : null,\n\t\t"b" : 3453,\n\t\t"foo" : {\n\t\t\t"a" : "a",\n\t\t\t"b" : "b",\n\t\t\t"c" : 1234\n\t\t},\n\t\t"bar" : [\n\t\t    "a", "b", "c"\n\t\t]\n\t}\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The method lets you specify a list of ",(0,t.jsx)(n.code,{children:"$fields"})," to be accessed and extracted from the ",(0,t.jsx)(n.code,{children:"$request"}),". This is done using the\nDOT notation. Finally, call the ",(0,t.jsx)(n.code,{children:"sanitizeInput()"})," method on the ",(0,t.jsx)(n.code,{children:"$request"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$fields = ['data.name', 'data.description', 'data.is_private', 'data.blabla', 'data.foo.c'];\n$data = $request->sanitizeInput($fields);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The extracted ",(0,t.jsx)(n.code,{children:"$data"})," looks like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'[\n  "data" => [\n    "is_private" => false\n    "description" => "this is a rather long description text"\n    "foo" => [\n      "c" => 1234\n    ]\n  ]\n]\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note that ",(0,t.jsx)(n.code,{children:"data.blabla"})," is not within the ",(0,t.jsx)(n.code,{children:"$data"})," array, as it was not present within the ",(0,t.jsx)(n.code,{children:"$request"}),". Furthermore, all\nother fields from the ",(0,t.jsx)(n.code,{children:"$request"})," are omitted as they are not specified. So basically, the method creates some kind of\n",(0,t.jsx)(n.code,{children:"filter"})," on the ",(0,t.jsx)(n.code,{children:"$request"}),", only passing the defined values. Furthermore, the DOT Notation allows you to easily specify\nthe fields to would like to pass through. This makes partially updating a resource quite easy!"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Heads Up:"})}),"\n",(0,t.jsxs)(n.p,{children:["Note that the ",(0,t.jsx)(n.code,{children:"fillable fields"})," of an entity can be easily obtained with ",(0,t.jsx)(n.code,{children:"$entity->getFillable()"}),"!"]}),"\n",(0,t.jsx)(n.h3,{id:"mapinput",children:(0,t.jsx)(n.strong,{children:"mapInput"})}),"\n",(0,t.jsxs)(n.p,{children:["Sometimes you might want to map input from the request to other fields in order to automatically pass it to a ",(0,t.jsx)(n.code,{children:"Action"}),"\nor ",(0,t.jsx)(n.code,{children:"Task"}),". Of course, you can manually map those fields, but you can also rely on the ",(0,t.jsx)(n.code,{children:"mapInput(array $fields)"})," helper\nfunction."]}),"\n",(0,t.jsx)(n.p,{children:'This helper, in turn, allows to "redefine" keys in the request for subsequent processing. Consider the following\nexample request:'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n\t"data" : {\n\t\t"name" : "John Doe"\n\t}\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Your Task to process this data, however, requests the field ",(0,t.jsx)(n.code,{children:"data.name"})," as ",(0,t.jsx)(n.code,{children:"data.username"}),". You can call the helper\nlike this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$request->mapInput([\n    'data.name' => 'data.username',\n]);\n"})}),"\n",(0,t.jsx)(n.p,{children:"The resulting structure would look like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n\t"data" : {\n\t\t"username" : "John Doe"\n\t}\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"storing-data-on-the-request",children:"Storing Data on the Request"}),"\n",(0,t.jsx)(n.p,{children:"During the Request life-cycle you may want to store some data on the request object and pass it to other SubActions (or Tasks)."}),"\n",(0,t.jsx)(n.p,{children:"To store some data on the request use:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$request->keep(['someKey' => $someValue]);\n"})}),"\n",(0,t.jsx)(n.p,{children:"To retrieve the data back at any time during the request life-cycle use:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$someValue = $request->retrieve('someKey')\n"})}),"\n",(0,t.jsx)(n.h2,{id:"unit-testing-for-actions-request",children:"Unit Testing for Actions (Request)"}),"\n",(0,t.jsx)(n.p,{children:"Since we're passing Request objects to Actions. When writing unit tests we need to create fake Request just to pass it to the Action with some fake data."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// creating\n$request = RegisterUserRequest::injectData($data);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example One:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$data = [\n    'email'    => 'Mahmoud@test.test',\n    'name'     => 'Mahmoud',\n    'password' => 'so-secret',\n];\n\n// create request object with some data\n$request = RegisterUserRequest::injectData($data);\n\n// create instance of the Action\n$action = App::make(RegisterUserAction::class)->run($request);\n\n// do any kind of assertions..\n$this->assertInstanceOf(User::class, $user);\n\n// ...\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example Two (With Authenticated User):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"$data = [\n   'store_id'  => $this->encode($store->id),\n   'items'     => $orderItems,\n   'recipient' => $receipient,\n];\n\n$user = factory(User::class)->create();\n\n$request = MakeOrderRequest::injectData($data, $user);\n\n$order = App::make(MakeOrderAction::class)->run($request);\n\n// ...\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);