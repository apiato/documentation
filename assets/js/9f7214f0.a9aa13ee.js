"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[1808],{15680:(e,i,t)=>{t.d(i,{xA:()=>c,yg:()=>y});var n=t(96540);function a(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function r(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{};i%2?r(Object(t),!0).forEach((function(i){a(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}))}return e}function l(e,i){if(null==e)return{};var t,n,a=function(e,i){if(null==e)return{};var t,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],i.indexOf(t)>=0||(a[t]=e[t]);return a}(e,i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],i.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=n.createContext({}),s=function(e){var i=n.useContext(p),t=i;return e&&(t="function"==typeof e?e(i):o(o({},i),e)),t},c=function(e){var i=s(e.components);return n.createElement(p.Provider,{value:i},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var i=e.children;return n.createElement(n.Fragment,{},i)}},u=n.forwardRef((function(e,i){var t=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(t),u=a,y=d["".concat(p,".").concat(u)]||d[u]||m[u]||r;return t?n.createElement(y,o(o({ref:i},c),{},{components:t})):n.createElement(y,o({ref:i},c))}));function y(e,i){var t=arguments,a=i&&i.mdxType;if("string"==typeof e||a){var r=t.length,o=new Array(r);o[0]=u;var l={};for(var p in i)hasOwnProperty.call(i,p)&&(l[p]=i[p]);l.originalType=e,l[d]="string"==typeof e?e:a,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},90932:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>p,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=t(58168),a=(t(96540),t(15680));const r={sidebar_position:5,title:"Email Verification"},o=void 0,l={unversionedId:"security/email-varification",id:"version-12.x/security/email-varification",title:"Email Verification",description:"Many web applications require users to verify their email addresses before using the application.",source:"@site/versioned_docs/version-12.x/security/email-varification.md",sourceDirName:"security",slug:"/security/email-varification",permalink:"/docs/security/email-varification",draft:!1,editUrl:"https://github.com/apiato/documentation/tree/master/versioned_docs/version-12.x/security/email-varification.md",tags:[],version:"12.x",lastUpdatedBy:"Mohammad Alavi",lastUpdatedAt:1697511591,formattedLastUpdatedAt:"Oct 17, 2023",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Email Verification"},sidebar:"tutorialSidebar",previous:{title:"Authorization",permalink:"/docs/security/authorization"},next:{title:"Password Reset",permalink:"/docs/security/password-reset"}},p={},s=[{value:"Configuration",id:"configuration",level:2},{value:"Model Preparation",id:"model-preparation",level:3},{value:"Database Preparation",id:"database-preparation",level:3},{value:"Routing",id:"routing",level:2},{value:"The Email Verification Notice",id:"the-email-verification-notice",level:3},{value:"The Email Verification Handler",id:"the-email-verification-handler",level:3},{value:"Resending The Verification Email",id:"resending-the-verification-email",level:3},{value:"Protecting Routes",id:"protecting-routes",level:3},{value:"Process Flow",id:"process-flow",level:2}],c={toc:s},d="wrapper";function m(e){let{components:i,...t}=e;return(0,a.yg)(d,(0,n.A)({},c,t,{components:i,mdxType:"MDXLayout"}),(0,a.yg)("p",null,"Many web applications require users to verify their email addresses before using the application.\nTo simplify this process, Apiato offers built-in services for sending and verifying email verification requests."),(0,a.yg)("h2",{id:"configuration"},"Configuration"),(0,a.yg)("p",null,"All the settings related to email verification are stored in the ",(0,a.yg)("inlineCode",{parentName:"p"},"app/Containers/AppSection/Authorization/Configs/appSection-authentication")," configuration file.  "),(0,a.yg)("p",null,"Activate email verification\nby setting the ",(0,a.yg)("inlineCode",{parentName:"p"},"require_email_verification")," option in the ",(0,a.yg)("inlineCode",{parentName:"p"},"appSection-authentication")," configuration file to ",(0,a.yg)("inlineCode",{parentName:"p"},"true"),".  "),(0,a.yg)("p",null,"Also, ensure that your application is configured to send email messages."),(0,a.yg)("admonition",{type:"tip"},(0,a.yg)("p",{parentName:"admonition"},"Detailed information on email configuration can be found in the ",(0,a.yg)("a",{parentName:"p",href:"https://laravel.com/docs/mail"},"Laravel documentation"),".")),(0,a.yg)("p",null,"Include your web app's email verification redirect page URL (e.g., ",(0,a.yg)("inlineCode",{parentName:"p"},"https://myapp.com/email/verify"),") in the ",(0,a.yg)("inlineCode",{parentName:"p"},"allowed-verify-email-urls")," array within the ",(0,a.yg)("inlineCode",{parentName:"p"},"appSection-authentication")," config."),(0,a.yg)("h3",{id:"model-preparation"},"Model Preparation"),(0,a.yg)("p",null,"Confirm that your ",(0,a.yg)("inlineCode",{parentName:"p"},"User")," model implements the ",(0,a.yg)("inlineCode",{parentName:"p"},"MustVerifyEmail")," contract. The default ",(0,a.yg)("inlineCode",{parentName:"p"},"User")," model in Apiato typically includes this requirement."),(0,a.yg)("h3",{id:"database-preparation"},"Database Preparation"),(0,a.yg)("p",null,"Ensure your ",(0,a.yg)("inlineCode",{parentName:"p"},"users")," table contains an ",(0,a.yg)("inlineCode",{parentName:"p"},"email_verified_at")," column to store the email verification date and time.\nThe migration for the ",(0,a.yg)("inlineCode",{parentName:"p"},"users")," table, included with Apiato, already includes this column."),(0,a.yg)("h2",{id:"routing"},"Routing"),(0,a.yg)("h3",{id:"the-email-verification-notice"},"The Email Verification Notice"),(0,a.yg)("p",null,"If you've enabled email verification,\nthe API will automatically send an email verification link to the user's provided email address upon user creation."),(0,a.yg)("h3",{id:"the-email-verification-handler"},"The Email Verification Handler"),(0,a.yg)("p",null,"Define a route to handle requests when the user clicks the email verification link sent via email.\nApiato includes a route for this purpose, ",(0,a.yg)("inlineCode",{parentName:"p"},"email/verify/{id}/{hash}"),"."),(0,a.yg)("h3",{id:"resending-the-verification-email"},"Resending The Verification Email"),(0,a.yg)("p",null,"To resend the email verification link, use the ",(0,a.yg)("inlineCode",{parentName:"p"},"/email/verification-notification")," endpoint."),(0,a.yg)("h3",{id:"protecting-routes"},"Protecting Routes"),(0,a.yg)("p",null,"Apply the ",(0,a.yg)("inlineCode",{parentName:"p"},"verified")," middleware to restrict access to certain routes for confirmed users.\nWhen email verification is enabled, unverified users trying to access protected endpoints will trigger an exception,\nprompting them to confirm their email address."),(0,a.yg)("p",null,"Please note that if email verification is disabled,\nthe ",(0,a.yg)("inlineCode",{parentName:"p"},"verified")," middleware won't protect routes against unconfirmed users and will have no effect."),(0,a.yg)("h2",{id:"process-flow"},"Process Flow"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"Add your web app's email verification redirect page URL (e.g., ",(0,a.yg)("inlineCode",{parentName:"p"},"https://myapp.com/email/verify"),") to the ",(0,a.yg)("inlineCode",{parentName:"p"},"allowed-verify-email-urls")," array in the ",(0,a.yg)("inlineCode",{parentName:"p"},"appSection-authentication")," config.")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"Send the email verification URL to the user by calling the ",(0,a.yg)("inlineCode",{parentName:"p"},"/email/verification-notification")," endpoint using your web app. Pass one of the valid URLs added in step 1 to the ",(0,a.yg)("inlineCode",{parentName:"p"},"verification_url")," field of the endpoint.")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"An email verification link will be sent to the user's email, resembling this format:\n",(0,a.yg)("inlineCode",{parentName:"p"},"https://myapp.test/email/verify?url=https://api.myapi.test/v1/email/verify/XbPW7awNkzl83LD6/eaabd911e2e07ede6456d3bd5725c6d4a5c2dc0b?expires=1646913047&signature=232702865b8353c445b39c50397e66db33c74df80e3db5a7c0d46ef94c8ab6a9"),".")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"When the user clicks the link, they'll be redirected to the URL specified in step 1, e.g., ",(0,a.yg)("inlineCode",{parentName:"p"},"https://myapp.com/email/verify"),", with the ",(0,a.yg)("inlineCode",{parentName:"p"},"url")," query string.")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"The ",(0,a.yg)("inlineCode",{parentName:"p"},"url")," is the complete URL your web app needs to call to verify the user. Simply make a request to this URL, and the user will be verified.")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"At this point, you should receive a ",(0,a.yg)("inlineCode",{parentName:"p"},"200")," OK response, confirming the user's email verification."))),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"If you encounter issues with the email verification link, such as a mismatched signature,\nwhen using a load balancer,\nset the ",(0,a.yg)("inlineCode",{parentName:"p"},"protected $proxies = '*'")," in the\n",(0,a.yg)("inlineCode",{parentName:"p"},"app/Ship/Middlewares/TrustProxies.php")," or customize it according to your needs.")))}m.isMDXComponent=!0}}]);