"use strict";(self.webpackChunkapiato_documentation=self.webpackChunkapiato_documentation||[]).push([[44195],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}},71431:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"components/main-components/requests","title":"Requests","description":"Requests components are a way to interact with the current HTTP request","source":"@site/docs/components/main-components/requests.md","sourceDirName":"components/main-components","slug":"/components/main-components/requests","permalink":"/docs/next/components/main-components/requests","draft":false,"unlisted":false,"editUrl":"https://github.com/apiato/documentation/tree/master/docs/components/main-components/requests.md","tags":[{"inline":true,"label":"component","permalink":"/docs/next/tags/component"},{"inline":true,"label":"main-component","permalink":"/docs/next/tags/main-component"},{"inline":true,"label":"request","permalink":"/docs/next/tags/request"},{"inline":true,"label":"route","permalink":"/docs/next/tags/route"},{"inline":true,"label":"controller","permalink":"/docs/next/tags/controller"},{"inline":true,"label":"action","permalink":"/docs/next/tags/action"}],"version":"current","lastUpdatedBy":"Mohammad Alavi","lastUpdatedAt":1746631000000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Requests","tags":["component","main-component","request","route","controller","action"]},"sidebar":"tutorialSidebar","previous":{"title":"Controllers","permalink":"/docs/next/components/main-components/controllers"},"next":{"title":"Actions","permalink":"/docs/next/components/main-components/actions"}}');var i=t(74848),a=t(28453);const r={sidebar_position:3,title:"Requests",tags:["component","main-component","request","route","controller","action"]},o=void 0,d={},l=[{value:"Definition and Principles",id:"definition-and-principles",level:2},{value:"Rules",id:"rules",level:2},{value:"Folder Structure",id:"folder-structure",level:2},{value:"Code Example",id:"code-example",level:2},{value:"Validation",id:"validation",level:2},{value:"Hash ID Decoding",id:"hash-id-decoding",level:2},{value:"Sanitizing Input",id:"sanitizing-input",level:2},{value:"Force Accept Header",id:"force-accept-header",level:2},{value:"Etag",id:"etag",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://laravel.com/docs/requests",children:"Requests"})," components are a way to interact with the current HTTP request\nbeing handled by your application as well as retrieve the input,\ncookies, and files that were submitted with the request."]}),"\n",(0,i.jsxs)(n.p,{children:["To generate new requests, you may use the ",(0,i.jsx)(n.code,{children:"apiato:make:request"})," interactive command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"php artisan apiato:make:request\n"})}),"\n",(0,i.jsx)(n.h2,{id:"definition-and-principles",children:"Definition and Principles"}),"\n",(0,i.jsxs)(n.p,{children:["Read ",(0,i.jsx)(n.a,{href:"https://mahmoudz.github.io/Porto/docs/category/main-components",children:(0,i.jsx)(n.strong,{children:"Porto SAP Documentation (#Requests)"})}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"rules",children:"Rules"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Validation rules MUST be defined in the ",(0,i.jsx)(n.code,{children:"rules"})," method."]}),"\n",(0,i.jsxs)(n.li,{children:["All API Requests MUST be placed in the ",(0,i.jsx)(n.code,{children:"app/Containers/{Section}/{Container}/UI/API/Requests"})," directory."]}),"\n",(0,i.jsxs)(n.li,{children:["All Web Requests MUST be placed in the ",(0,i.jsx)(n.code,{children:"app/Containers/{Section}/{Container}/UI/WEB/Requests"})," directory."]}),"\n",(0,i.jsxs)(n.li,{children:["All Requests:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["MUST extend the ",(0,i.jsx)(n.code,{children:"App\\Ship\\Parents\\Requests\\Request"})," class.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The parent extension SHOULD be aliased as ",(0,i.jsx)(n.code,{children:"ParentRequest"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["MUST have a public ",(0,i.jsx)(n.code,{children:"rules"})," method, returning an array of validation rules."]}),"\n",(0,i.jsxs)(n.li,{children:["MUST have a public ",(0,i.jsx)(n.code,{children:"authorize"})," method, returning a boolean value."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"folder-structure",children:"Folder Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:"app\n\u2514\u2500\u2500 Containers\n    \u2514\u2500\u2500 Section\n        \u2514\u2500\u2500 Container\n            \u2514\u2500\u2500 UI\n                \u251c\u2500\u2500 API\n                \u2502   \u2514\u2500\u2500 Requests\n                \u2502       \u251c\u2500\u2500 CreateUserRequest.php\n                \u2502       \u251c\u2500\u2500 DeleteUserRequest.php\n                \u2502       \u2514\u2500\u2500 ...\n                \u2514\u2500\u2500 WEB\n                    \u2514\u2500\u2500 Requests\n                        \u251c\u2500\u2500 Login.php\n                        \u251c\u2500\u2500 Logout.php\n                        \u2514\u2500\u2500 ...\n"})}),"\n",(0,i.jsx)(n.h2,{id:"code-example",children:"Code Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use App\\Ship\\Parents\\Requests\\Request as ParentRequest;\n\nclass DemoRequest extends ParentRequest\n{\n    protected array $access = [];\n    protected array $decode = [];\n    protected array $urlParameters = [];\n\n    public function rules(): array\n    {\n        return [\n            'field' => 'min:3|max:50',\n        ];\n    }\n\n    public function authorize(): bool\n    {\n        return true;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,i.jsxs)(n.p,{children:["In Apiato,\nvalidation of incoming requests follows the\nLaravel ",(0,i.jsx)(n.a,{href:"https://laravel.com/docs/validation#form-request-validation",children:"Form Request Validation"})," approach."]}),"\n",(0,i.jsx)(n.p,{children:"Validation rules are defined within the respective Request class.\nThese rules are automatically enforced when a Request is injected into a Controller."}),"\n",(0,i.jsx)(n.p,{children:"Here's an example of a Request class with validation rules:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use App\\Ship\\Parents\\Requests\\Request as ParentRequest;\n\nclass RegisterUserRequest extends ParentRequest\n{\n    public function rules(): array\n    {\n        return [\n            'email'    => 'required|email|max:200|unique:users,email',\n            'password' => 'required|min:20|max:300',\n            'name'     => ['required', 'min:2', 'max:400'],\n        ];\n    }\n\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"And here's how you would use this Request class within a Controller:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function __invoke(RegisterUserRequest $request)\n{\n    $user = app(RegisterUserAction::class)->run($request);\n    \n    return $this->transform($user, UserTransformer::class);\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In this example,\nthe validation rules defined in ",(0,i.jsx)(n.code,{children:"RegisterUserRequest"})," will be automatically applied\nbefore the ",(0,i.jsx)(n.code,{children:"__invoke"})," method is executed.\nIf the validation fails, an appropriate error response will be generated."]}),"\n",(0,i.jsx)(n.p,{children:"Apiato introduces new properties to the Request Class that enhance its functionality."}),"\n",(0,i.jsx)(n.h2,{id:"hash-id-decoding",children:"Hash ID Decoding"}),"\n",(0,i.jsxs)(n.p,{children:["When you enable the ",(0,i.jsx)(n.a,{href:"/docs/next/security/hash-id",children:"Hash ID"})," feature, your application can receive Hashed IDs from users.\nThese Hashed IDs need to be decoded before they can be used."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"$decode"})," property is used to handle the decoding of Hashed IDs from the incoming Request.\nIt is an array that contains the names of the fields in the Request that should be decoded.\nWhen the Request is processed, Apiato will automatically decode these fields for you."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"class DemoRequest extends ParentRequest\n{\n    protected array $decode = [\n        'author_id',\n        'ids.*',\n        'authors.*.id',\n    ];\n}\n\n// Example usage\n// In all cases, the author_id fields will be automatically decoded\n$request->input('author_id');\n$request->all('author_id');\n$request->author_id\n\n// Nested fields are also supported\n$request->input('ids');\n$request->input('authors.*.id')\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can also decode route parameters.\nBut the decoded values will not be available via ",(0,i.jsx)(n.code,{children:"input"})," or ",(0,i.jsx)(n.code,{children:"all"})," methods.\nInstead, you can access them using the ",(0,i.jsx)(n.code,{children:"route"})," method."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// endpoint\n/users/{id}\n\n// request\nclass DemoRequest extends ParentRequest\n{\n    protected array $decode = ['id'];\n}\n\n// usage\n$request->route('id');\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sanitizing-input",children:"Sanitizing Input"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"sanitize"})," method can be used to cleanse request data."]}),"\n",(0,i.jsxs)(n.p,{children:["Particularly useful for ",(0,i.jsx)(n.code,{children:"PATCH"})," requests,\nwhere you may want\nto submit only the fields\nintended for modification to minimize traffic or perform partial updates to the corresponding database resource.\nTraditional checks for the presence or absence of specific keys in the request can lead to extensive ",(0,i.jsx)(n.code,{children:"if"})," blocks,\nsuch as:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"if ($request->has('data.name')) {\n   $data['name'] = $request->input('data.name');\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To circumvent these ",(0,i.jsx)(n.code,{children:"if"})," blocks, you might utilize ",(0,i.jsx)(n.code,{children:"array_filter($data)"})," to remove empty fields from the request.\nHowever, be aware that in PHP, both ",(0,i.jsx)(n.code,{children:"false"})," and an empty string ",(0,i.jsx)(n.code,{children:"''"})," are considered as ",(0,i.jsx)(n.code,{children:"empty"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["For streamlining data sanitization when using ",(0,i.jsx)(n.code,{children:"application/json"})," instead of ",(0,i.jsx)(n.code,{children:"x-www-form-urlencoded"}),",\nApiato provides the convenient ",(0,i.jsx)(n.code,{children:"sanitize"})," method."]}),"\n",(0,i.jsx)(n.p,{children:"Consider the following request:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "name": "Demo",\n    "description": "Some description",\n    "is_private": false,\n    "address": "",\n    "foo": {\n      "number": 1,\n      "bar": "bar"\n    }\n  },\n  "meta": "some meta data"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"sanitize"})," method enables you to specify a list of fields,\nemploying dot notation, to be accessed and extracted from the request."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$data = $request->sanitize([\n    'data.description',\n    'data.is_private',\n    'data.address',\n    'data.foo.number',\n    'email', // will be ignored\n    'meta',\n]);\n"})}),"\n",(0,i.jsx)(n.p,{children:"The extracted data will appear as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'[\n  "data" => [\n    "description" => "Some description"\n    "is_private" => false,\n    "address" => null, // empty string is converted to null by Laravel\n    "foo" => [\n      "number" => 1,\n    ]\n  ],\n  "meta" => "some meta data",\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Note that ",(0,i.jsx)(n.code,{children:"email"})," is excluded from the sanitized array, as it was absent in the request.\nAdditionally, any other fields not specified are omitted.\nIn essence, the method filters the request, retaining only the defined values."]}),"\n",(0,i.jsx)(n.p,{children:"You can also assign default values during the data sanitization process:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$sanitizedData = $request->sanitize([\n    'name' => 'John', // If name is not provided, the default value will be set\n    'product.company.address' => 'Somewhere in the world', // dot notation is supported\n    'email',\n    'password'\n]);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"force-accept-header",children:"Force Accept Header"}),"\n",(0,i.jsxs)(n.p,{children:["Typically, when making calls to a JSON API, you should include the ",(0,i.jsx)(n.code,{children:"accept: application/json"})," HTTP header.\nIn Apiato, you have the option to either enforce users to send this header or allow them to skip it."]}),"\n",(0,i.jsxs)(n.p,{children:["To enforce the ",(0,i.jsx)(n.code,{children:"accept: application/json"})," header,\nnavigate to the ",(0,i.jsx)(n.code,{children:"app/Ship/Configs/apiato.php"})," configuration file and set the ",(0,i.jsx)(n.code,{children:"force-accept-header"})," to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Conversely, if you wish to allow users to skip this header, set ",(0,i.jsx)(n.code,{children:"force-accept-header"})," to ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Forcing the accept header is disabled by default."})}),"\n",(0,i.jsx)(n.h2,{id:"etag",children:"Etag"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"ETag"})," or ",(0,i.jsx)(n.strong,{children:"entity tag"})," is part of HTTP, the protocol for the World Wide Web.\nIt is one of several mechanisms that HTTP provides for Web cache validation,\nwhich allows a client to make conditional requests.\nThis mechanism allows caches to be more efficient and saves bandwidth,\nas a Web server does not need to send a full response if the content has not changed.\n(",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/HTTP_ETag",children:"Wikipedia"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Apiato offers support for Etag through the ",(0,i.jsx)(n.code,{children:"Apiato\\Core\\Middlewares\\HttpProcessETagHeadersMiddleware"})," middleware,\nwhich employs the Shallow technique.\nThis middleware can be particularly valuable in reducing bandwidth usage for clients, especially on mobile devices."]}),"\n",(0,i.jsxs)(n.p,{children:["Please note that this feature is ",(0,i.jsx)(n.strong,{children:"disabled by default"}),". To enable it, follow these steps:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Navigate to the ",(0,i.jsx)(n.code,{children:"app/Ship/Configs/apiato.php"})," configuration file."]}),"\n",(0,i.jsxs)(n.li,{children:["Inside the configuration file, locate the ",(0,i.jsx)(n.code,{children:"use-etag"})," configuration parameter."]}),"\n",(0,i.jsxs)(n.li,{children:["Set the ",(0,i.jsx)(n.code,{children:"use-etag"})," parameter to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Keep in mind that for this feature to function correctly, the client must include the ",(0,i.jsx)(n.code,{children:"If-None-Match"})," HTTP header,\nwhich corresponds to the ETag value, in their request."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);