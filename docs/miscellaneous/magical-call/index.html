<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apiato Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apiato Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-37514928-10","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Apiato" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title data-react-helmet="true">Magical Call | Apiato</title><meta data-react-helmet="true" property="og:url" content="http://apiato.io//docs/miscellaneous/magical-call"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="9.x"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-9.x"><meta data-react-helmet="true" property="og:title" content="Magical Call | Apiato"><meta data-react-helmet="true" name="description" content="- The Magical Call"><meta data-react-helmet="true" property="og:description" content="- The Magical Call"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://apiato.io//docs/miscellaneous/magical-call"><link data-react-helmet="true" rel="alternate" href="http://apiato.io//docs/miscellaneous/magical-call" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://apiato.io//docs/miscellaneous/magical-call" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.bcbac3cb.css">
<link rel="preload" href="/assets/js/styles.2f28982e.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.95b00a46.js" as="script">
<link rel="preload" href="/assets/js/main.264abd1d.js" as="script">
<link rel="preload" href="/assets/js/1.db016d62.js" as="script">
<link rel="preload" href="/assets/js/2.ce6aae9f.js" as="script">
<link rel="preload" href="/assets/js/3.002620f0.js" as="script">
<link rel="preload" href="/assets/js/1be78505.10402c24.js" as="script">
<link rel="preload" href="/assets/js/152.bc713a44.js" as="script">
<link rel="preload" href="/assets/js/90c91afe.75e35259.js" as="script">
<link rel="preload" href="/assets/js/17896441.1f0b69a8.js" as="script">
<link rel="preload" href="/assets/js/cc5c6d64.555fecd1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Apiato Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Apiato Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Apiato</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/docs/">9.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/miscellaneous/magical-call">9.x</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apiato/apiato" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Apiato Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Apiato Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Apiato</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/">Next</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/miscellaneous/magical-call">9.x</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apiato/apiato" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/requests">Requests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/responses">Responses</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/software-architectural-patterns">Software Architectural Patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/conventions-and-principles">Conventions and Principles</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/code-generator">Code Generator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/api-docs-generator">API Docs Generator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/authentication">Authentication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/authorization">Authorization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/user-registration">User Registration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/social-authentication">Social Authentication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/query-parameters">Query Parameters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/default-endpoints">Default Endpoints</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/hash-id">Hash ID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/localization">Localization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/rate-limiting">Rate Limiting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/requests-monitor">Requests Monitor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/data-caching">Data Caching</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/pagination">Pagination</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/payments">Payments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/system-settings">System Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/api-versioning">API Versioning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/validation">Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/search-query-parameter">Search Query Parameter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/etag">ETag</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/useful-commands">Useful Commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/admin-dashboard">Admin Dashboard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features/profiler">Profiler</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Main Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/routes">Routes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/controllers">Controllers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/requests">Requests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/transporters">Transporters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/actions">Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/tasks">Tasks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/models">Models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/views">Views</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/transformers">Transformers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/main-components/subactions">Sub Actions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Optional Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/providers">Providers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/repositories">Repositories</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/exceptions">Exceptions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/criterias">Criterias</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/tests">Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/migrations">Migrations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/seeders">Seeders</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/factories">Factories</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/middlewares">Middlewares</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/configs">Configs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/commands">Commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/jobs">Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/languages">Languages</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/events">Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/mails">Mails</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/notifications">Notifications</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/optional-components/values">Values</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Miscellaneous</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/miscellaneous/magical-call">Magical Call</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/miscellaneous/tests-helpers">Tests Helpers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/miscellaneous/tasks-scheduling">Tasks Scheduling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/miscellaneous/tasks-queuing">Tasks Queuing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/miscellaneous/container-installer">Containers Installer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/miscellaneous/postman">Postman Environment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">General</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/general/faq">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/general/contribution-guide">Contribution Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/general/upgrade-guide">Upgrade Guide</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apiato/awesome-apiato" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN">3rd Party Containers</a></li><li class="menu__list-item"><a href="https://github.com/apiato/apiato/releases" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN">Change Log</a></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: 9.x</span></div><header><h1 class="docTitle_3a4h">Magical Call</h1></header><div class="markdown"><ul><li><a href="#the-magical-call">The Magical Call</a><ul><li><a href="#usage-options">Usage options</a><ul><li><a href="#basic-usage">Basic Usage</a></li><li><a href="#passing-arguments-to-the-run-function">Passing arguments to the run function</a></li><li><a href="#calling-other-functions-before-the-run">Calling other functions before the run</a></li><li><a href="#calling-other-functions-and-pass-them-arguments">Calling other functions and pass them arguments:</a></li></ul></li></ul></li><li><a href="#transactional-call">Transactional Magical Call</a></li><li><a href="#use-case-example">Use case example:</a><ul><li><a href="#the-list-users-task-class">The ListUsersTask class:</a></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-magical-call"></a>The Magical Call<a class="hash-link" href="#the-magical-call" title="Direct link to heading">#</a></h2><p>This magical function allows you to call any Action or Task <code>run</code> function, from anywhere. Using the <code>Apiato::call()</code> Facade.</p><p>The function <code>call</code> is mainly used for calling Apiato <code>Actions</code> from <code>Controllers</code> and for calling Apiato <code>Tasks</code>
from <code>Actions</code>.</p><p>Each Action knows which UI called it, using <code>$this-&gt;getUI()</code>, this is useful for handling the same Action differently
based on the UI type (Web or API). This will work when calling the Action from Controllers and Commands using the
magical <code>call()</code> function.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage-options"></a>Usage options<a class="hash-link" href="#usage-options" title="Direct link to heading">#</a></h3><p>In the first argument you can pass the class full name, as follows <code>App\Containers\User\Tasks\CreateUserTask::class</code>,
or you can pass the container name and class name, as follows <code>User@CreateUserTask</code>.</p><p>It is highly recommended to use Apiato caller style <code>containerName@className</code> as it helps to remove direct
dependencies between containers. The function will verify the Container exist before calling the function and inform
the user to install Container if not exist.</p><p>Note: When a class is directly called using his full name, a warning will be logged informing you to use the
&quot;apiato caller style&quot;. This info, however, can be disabled by changing the flag
<code>apiato.logging.log-wrong-apiato-caller-style</code> in the <code>Ship/Configs/apiato.php</code> file accordingly.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&lt;?php</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">// Call &quot;AssignUserToRoleTask&quot; Task from the &quot;Authorization&quot; Container using the apiato caller style</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Apiato::call(&#x27;Authorization@AssignUserToRoleTask&#x27;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">// Call &quot;AssignUserToRoleTask&quot; Task from the &quot;Authorization&quot; Container using class full name.</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">// This will cause to add an INFO entry to the log file!</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Apiato::call(\App\Containers\Authorization\Tasks\AssignUserToRoleTask::class);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="basic-usage"></a>Basic Usage<a class="hash-link" href="#basic-usage" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$foo = \Apiato\Core\Foundation\Facades\Apiato::call(&#x27;Container@ActionOrTask&#x27;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Notes</strong>:</p><ul><li>From Controllers and Actions you can use the <code>$this-&gt;call(&#x27;Container@ActionOrTask&#x27;)</code> instead of the Facade, but it&#x27;s not recommended.</li><li>The magical <code>call</code> function accepts the class full namespace (<code>\App\Containers\User\Tasks\GetAllUsersTask::class</code>), and Apiato caller style (<code>Containers@GetAllUsersTask</code>).</li><li>There is also a <code>transactionalCall()</code> method available, that wraps everything in a <code>DB::Transaction</code> (see below).</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="passing-arguments-to-the-run-function"></a>Passing arguments to the <code>run</code> function<a class="hash-link" href="#passing-arguments-to-the-run-function" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$foo = Apiato::call(&#x27;Container@ActionOrTask&#x27;, [$runArgument1, $runArgument2, $runArgument3]);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="calling-other-functions-before-the-run"></a>Calling other functions before calling the <code>run</code><a class="hash-link" href="#calling-other-functions-before-the-run" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$foo = Apiato::call(&#x27;Container@ActionOrTask&#x27;, [$runArgument], [&#x27;otherFunction1&#x27;, &#x27;otherFunction2&#x27;]);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="calling-other-functions-and-pass-them-arguments"></a>Calling other functions and pass them arguments before calling the <code>run</code><a class="hash-link" href="#calling-other-functions-and-pass-them-arguments" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&lt;?php</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$foo = Apiato::call(&#x27;Container@ActionOrTask&#x27;, [$runArgument], [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       &#x27;function1&#x27; =&gt; [&#x27;function1-argument1&#x27;, &#x27;function1-argument2&#x27;]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ],</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       &#x27;function2&#x27; =&gt; [&#x27;function2-argument1&#x27;]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ],</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">]);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$foo = Apiato::call(&#x27;Container@ActionOrTask&#x27;, [$runArgument], [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &#x27;function-without-argument&#x27;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      &#x27;function1&#x27; =&gt; [&#x27;function1-argument1&#x27;, &#x27;function1-argument2&#x27;]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ],</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">]);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$foo = Apiato::call(&#x27;Container@ActionOrTask&#x27;, [], [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &#x27;function-without-argument&#x27;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      &#x27;function1&#x27; =&gt; [&#x27;function1-argument1&#x27;, &#x27;function1-argument2&#x27;]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ],</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    &#x27;another-function-without-argument&#x27;,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    [</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      &#x27;function2&#x27; =&gt; [&#x27;function2-argument1&#x27;, &#x27;function2-argument2&#x27;, &#x27;function2-argument3&#x27;]</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ],</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">]);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transactional-call"></a>Transactional Magical Call<a class="hash-link" href="#transactional-call" title="Direct link to heading">#</a></h2><p>Sometimes, you want to wrap a call into one <code>Database Transaction</code> (see
<a href="https://laravel.com/docs/master/database#database-transactions" target="_blank" rel="noopener noreferrer">Laravel Documentation</a>).</p><p>Consider the following example: You want to create a new <code>Team</code> and automatically assign yourself (i.e., your own
<code>User</code>) to this newly created <code>Team</code>. Your <code>CreateTeamAction</code> may call a dedicated <code>CreateTeamTask</code> and a
<code>AssignMemberToTeamTask</code> afterwards.</p><p> However, if the <code>AssignMemberToTeamTask</code> fails, for unknown reasons, you may want to &quot;rollback&quot; (i.e., remove) the
newly created <code>Team</code> from the database in order to keep the database in a valid state.</p><p> That&#x27;s where <code>DB::transactions</code> comes into play!</p><p> Apiato provides a <code>transactionalCall($class, $params, $extraMethods)</code> method with the similar parameters as already
known from the  <code>call()</code> method. Internally, this method calls this <code>call()</code> method anyways, but wraps it into a
<code>DB::transaction</code>.</p><p> If any <code>Exception</code> occurs during the execution of the <code>$class</code> to be called, everything done in this context is
automatically rolled-back from the database. However, respective operations on the file system (e.g., you may also
have uploaded a profile picture for this <code>Team</code> already that needs to be removed in this case) need to be performed
manually!</p><p> Typically, you may want to use the <code>transactionalCall()</code> on the <code>Controller</code> level!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="use-case-example"></a>Use case example<a class="hash-link" href="#use-case-example" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&lt;?php</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">return Apiato::call(&#x27;User@ListUsersTask&#x27;, [], [&#x27;ordered&#x27;]);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">// can be called this way as well Apiato::call(ListUsersTask::class, [], [&#x27;ordered&#x27;]);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">return Apiato::call(&#x27;User@ListUsersTask&#x27;, [], [&#x27;ordered&#x27;, &#x27;clients&#x27;]);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">return Apiato::call(&#x27;User@ListUsersTask&#x27;, [], [&#x27;admins&#x27;]);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">return Apiato::call(&#x27;User@ListUsersTask&#x27;, [], [&#x27;admins&#x27;, [&#x27;roles&#x27; =&gt; [&#x27;manager&#x27;, &#x27;employee&#x27;]]]);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-list-users-task-class"></a>The ListUsersTask class<a class="hash-link" href="#the-list-users-task-class" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><div tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">&lt;?php</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">namespace App\Containers\User\Tasks;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">use App\Containers\User\Data\Criterias\AdminsCriteria;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">use App\Containers\User\Data\Criterias\ClientsCriteria;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">use App\Containers\User\Data\Criterias\RoleCriteria;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">use App\Containers\User\Data\Repositories\UserRepository;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">use App\Ship\Criterias\Eloquent\OrderByCreationDateDescendingCriteria;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">use App\Ship\Parents\Tasks\Task;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">class ListUsersTask extends Task</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">{</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private $userRepository;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public function __construct(UserRepository $userRepository)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        $this-&gt;userRepository = $userRepository;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public function run()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        return $this-&gt;userRepository-&gt;paginate();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public function clients()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        $this-&gt;userRepository-&gt;pushCriteria(new ClientsCriteria());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public function admins()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        $this-&gt;userRepository-&gt;pushCriteria(new AdminsCriteria());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public function ordered()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        $this-&gt;userRepository-&gt;pushCriteria(new OrderByCreationDateDescendingCriteria());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public function withRole($roles)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        $this-&gt;userRepository-&gt;pushCriteria(new RoleCriteria($roles));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/apiato/documentation/tree/master/versioned_docs/version-9.x/miscellaneous/magical-call.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-10T23:17:11.000Z" class="lastUpdatedDate_1WI_">4/10/2021</time> by <strong>Moslem Deris</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/optional-components/values"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Values</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/miscellaneous/tests-helpers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tests Helpers Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-magical-call" class="table-of-contents__link">The Magical Call</a><ul><li><a href="#usage-options" class="table-of-contents__link">Usage options</a></li></ul></li><li><a href="#transactional-call" class="table-of-contents__link">Transactional Magical Call</a></li><li><a href="#use-case-example" class="table-of-contents__link">Use case example</a><ul><li><a href="#the-list-users-task-class" class="table-of-contents__link">The ListUsersTask class</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Getting Started</a></li><li class="footer__item"><a href="https://github.com/Mahmoudz/Porto#porto-software-architectural-pattern" target="_blank" rel="noopener noreferrer" class="footer__link-item">Porto Architecture</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/ryPcV4KM5k" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord Server</a></li><li class="footer__item"><a href="https://github.com/apiato/apiato/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contributors</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/general/contribution-guide">Contribution Guide</a></li><li class="footer__item"><a href="https://github.com/apiato/apiato/blob/9.0/CODE_OF_CONDUCT.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code of Conduct</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Sponsors</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apiato/apiato#sponsors" target="_blank" rel="noopener noreferrer" class="footer__link-item">Our Sponsors</a></li><li class="footer__item"><a href="https://opencollective.com/apiato" target="_blank" rel="noopener noreferrer" class="footer__link-item">Become a Sponsor</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2016 - 2021</div></div></div></footer></div>
<script src="/assets/js/styles.2f28982e.js"></script>
<script src="/assets/js/runtime~main.95b00a46.js"></script>
<script src="/assets/js/main.264abd1d.js"></script>
<script src="/assets/js/1.db016d62.js"></script>
<script src="/assets/js/2.ce6aae9f.js"></script>
<script src="/assets/js/3.002620f0.js"></script>
<script src="/assets/js/1be78505.10402c24.js"></script>
<script src="/assets/js/152.bc713a44.js"></script>
<script src="/assets/js/90c91afe.75e35259.js"></script>
<script src="/assets/js/17896441.1f0b69a8.js"></script>
<script src="/assets/js/cc5c6d64.555fecd1.js"></script>
</body>
</html>